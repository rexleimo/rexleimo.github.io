<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Middleware Optimization Trick That Made My Node.js Server 40% Faster | Ê¢¶ÂÖΩÁºñÁ®ã</title><meta name=keywords content="Node.js,Middleware,Performance Optimization,Backend Development"><meta name=description content="Learn this middleware design pattern to dramatically boost Node.js performance, reduce latency, and improve scalability without rewriting your code"><meta name=author content="Dream Beast Programming"><link rel=canonical href=https://rexai.top/en/js-news/nodejs-middleware-optimization-performance-boost/><link crossorigin=anonymous href=/assets/css/stylesheet.36a35dd316f612e0d26c90cd90313d15705d24943d7cf2559674e92b21704616.css integrity="sha256-NqNd0xb2EuDSbJDNkDE9FXBdJJQ9fPJVlnTpKyFwRhY=" rel="preload stylesheet" as=style><link rel=icon href=https://rexai.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rexai.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rexai.top/favicon-32x32.png><link rel=apple-touch-icon href=https://rexai.top/apple-touch-icon.png><link rel=mask-icon href=https://rexai.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/><link rel=alternate hreflang=en href=https://rexai.top/en/js-news/nodejs-middleware-optimization-performance-boost/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/css/extended/modern-typography.min.css integrity><style>.promotion-section{margin-top:3rem;padding:2rem;text-align:center;background:linear-gradient(135deg,rgba(59,130,246,5%) 0%,rgba(139,92,246,5%) 100%);border-radius:16px;border:1px solid rgba(59,130,246,.1);position:relative;overflow:hidden}.promotion-section::before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#06b6d4);border-radius:16px 16px 0 0}.promotion-section h3{margin-bottom:1.5rem;color:var(--primary);font-size:1.5rem;font-weight:600;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.qr-codes{display:flex;gap:2.5rem;justify-content:center;flex-wrap:wrap;margin-top:2rem}.qr-item{text-align:center;position:relative;transition:transform .3s ease}.qr-item:hover{transform:translateY(-5px)}.qr-item img{width:160px;height:160px;border:2px solid #e5e7eb;border-radius:16px;padding:12px;background:#fff;box-shadow:0 4px 20px rgba(0,0,0,8%),0 1px 3px rgba(0,0,0,.1);transition:all .3s ease;position:relative;overflow:hidden}.qr-item img::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(59,130,246,.1),rgba(139,92,246,.1));opacity:0;transition:opacity .3s ease;z-index:1}.qr-item:hover img{border-color:#3b82f6;box-shadow:0 8px 30px rgba(59,130,246,.2),0 2px 8px rgba(0,0,0,.1);transform:scale(1.02)}.qr-item:hover img::before{opacity:1}.qr-item p{margin-top:1rem;font-size:1rem;color:var(--secondary);font-weight:500;position:relative}.modern-button{display:inline-flex;align-items:center;padding:.75rem 1.5rem;background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;text-decoration:none;border-radius:12px;font-weight:500;transition:all .3s ease;box-shadow:0 4px 12px rgba(59,130,246,.3);position:relative;overflow:hidden}.modern-button::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .6s ease}.modern-button:hover::before{left:100%}.modern-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(59,130,246,.4)}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.post-content>*{animation:fadeInUp .6s ease-out;animation-fill-mode:both}.post-content>*:nth-child(1){animation-delay:.1s}.post-content>*:nth-child(2){animation-delay:.2s}.post-content>*:nth-child(3){animation-delay:.3s}.post-content>*:nth-child(4){animation-delay:.4s}@media(max-width:768px){.promotion-section{margin:2rem -1rem;border-radius:0;padding:1.5rem 1rem}.qr-codes{flex-direction:column;align-items:center;gap:1.5rem}.qr-item img{width:140px;height:140px;padding:10px}.promotion-section h3{font-size:1.25rem}}.reading-progress{position:fixed;top:0;left:0;width:0%;height:3px;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#06b6d4);z-index:999;transition:width .1s ease}.post-actions{margin-top:2.5rem;padding-top:1.25rem;border-top:1px dashed var(--border)}.post-actions__group{display:flex;flex-wrap:wrap;gap:.75rem 1rem;align-items:center}.post-actions__item{display:inline-flex;align-items:center}*{transition:background-color .3s ease,color .3s ease,border-color .3s ease}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:var(--theme)}::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#2563eb,#7c3aed)}</style><script>document.addEventListener("DOMContentLoaded",function(){const e=document.createElement("div");e.className="reading-progress",document.body.appendChild(e);function t(){const t=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,s=t/n*100;e.style.width=s+"%"}window.addEventListener("scroll",t),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})})})</script><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-K6VQRF8T")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K6VQRF8T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-62VF26DEY6"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-62VF26DEY6")</script><meta property="og:url" content="https://rexai.top/en/js-news/nodejs-middleware-optimization-performance-boost/"><meta property="og:site_name" content="Ê¢¶ÂÖΩÁºñÁ®ã"><meta property="og:title" content="The Middleware Optimization Trick That Made My Node.js Server 40% Faster"><meta property="og:description" content="Learn this middleware design pattern to dramatically boost Node.js performance, reduce latency, and improve scalability without rewriting your code"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="js-news"><meta property="article:published_time" content="2025-08-19T23:35:58+08:00"><meta property="article:modified_time" content="2025-08-19T23:35:58+08:00"><meta property="article:tag" content="Node.js"><meta property="article:tag" content="Middleware"><meta property="article:tag" content="Performance Optimization"><meta property="article:tag" content="Backend Development"><meta property="og:image" content="https://rexai.top/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rexai.top/cover.png"><meta name=twitter:title content="The Middleware Optimization Trick That Made My Node.js Server 40% Faster"><meta name=twitter:description content="Learn this middleware design pattern to dramatically boost Node.js performance, reduce latency, and improve scalability without rewriting your code"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Js-News","item":"https://rexai.top/en/js-news/"},{"@type":"ListItem","position":2,"name":"The Middleware Optimization Trick That Made My Node.js Server 40% Faster","item":"https://rexai.top/en/js-news/nodejs-middleware-optimization-performance-boost/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Middleware Optimization Trick That Made My Node.js Server 40% Faster","name":"The Middleware Optimization Trick That Made My Node.js Server 40% Faster","description":"Learn this middleware design pattern to dramatically boost Node.js performance, reduce latency, and improve scalability without rewriting your code","keywords":["Node.js","Middleware","Performance Optimization","Backend Development"],"articleBody":"Have you ever been in this situation: your Node.js server is getting slower and slower, users are complaining about page lag, but you don‚Äôt want to undertake a massive rewrite of your entire project?\nDon‚Äôt panic! Today I‚Äôm sharing a ‚Äúlazy but effective‚Äù optimization approach‚Äîmiddleware refactoring. Using this method, my server performance improved by 40%, and the code became cleaner too.\nWhat is Middleware? Let‚Äôs Get This Concept Clear First Simply put, middleware is like a restaurant server. You order a dish (make a request), the kitchen prepares it (processing logic), but before the dish reaches your table, the server has to do many things:\nCheck if the dish is complete (data validation) Verify your identity (user authentication) Record this service (logging) Handle special requests (error handling) In Node.js, middleware are these ‚Äúservers,‚Äù handling various tasks between requests and final responses.\nIf you‚Äôve used Express.js, you‚Äôre definitely already using middleware‚Äîyou just might not have realized it.\nWhat‚Äôs the Problem? The Middleware Mistake Most People Make My previous code looked like this:\n// Every route has to run a bunch of middleware app.get('/users', logRequest, authCheck, loadUserData, getUsers); app.get('/products', logRequest, authCheck, loadUserData, fetchProducts); app.get('/public/info', logRequest, authCheck, loadUserData, getPublicInfo); See the problem? It‚Äôs like making every customer go through VIP lounge security, even if they‚Äôre just going to the regular dining hall for fast food.\nThe results of doing this:\nRedundant execution: The same middleware runs on every route Unnecessary overhead: Public pages also have to load user data Debugging nightmare: When something breaks, you have no idea which step got stuck The Solution: Layered Middleware Architecture I reorganized middleware into a four-layer structure, just like airport security:\nGlobal Middleware: Basic checks everyone has to pass (request parsing, logging) Route Group Middleware: Area-specific checks (like extra security only international flights need) Context Middleware: Situation-specific checks (business class has dedicated lanes) Handlers: Final business logic (boarding)\nHere‚Äôs how it‚Äôs implemented:\n// Global middleware - all requests need this app.use(express.json()); app.use(logger); // Public route group - simplest processing const publicRouter = express.Router(); publicRouter.get('/info', getPublicInfo); publicRouter.get('/docs', getDocs); app.use('/public', publicRouter); // Private route group - requires authentication const privateRouter = express.Router(); privateRouter.use(authCheck); // Only this group needs authentication privateRouter.use(loadUserData); // Only this group needs user data privateRouter.get('/profile', getUserProfile); privateRouter.get('/settings', getUserSettings); app.use('/private', privateRouter); Why Does This Make It 40% Faster? Reduces unnecessary middleware execution: Public pages no longer need to load user data, directly saving database queries\nLowers I/O bottlenecks: Moves expensive operations (like database queries) to when they‚Äôre actually needed\nBetter cache utilization: Similar request types can share cache, avoiding duplicate computations\nIt‚Äôs like highway ETC lanes‚Äîdifferent types of vehicles use different lanes, naturally improving overall traffic efficiency.\nHow Did I Measure This 40% Improvement? Data doesn‚Äôt lie. I used these tools:\nApache Benchmark (ab): Simulating high-concurrency requests New Relic: Real-time performance monitoring\nBefore optimization:\nAverage response time: 450ms Concurrent processing capacity: 200 req/s CPU usage: 75% After optimization:\nAverage response time: 270ms (40% improvement) Concurrent processing capacity: 350 req/s (75% improvement) CPU usage: 45% (40% reduction) A Few Tips to Make Middleware Faster Order matters: Put lightweight, frequently used middleware first, and heavy, rarely used middleware last\nAvoid middleware bloat: If a function isn‚Äôt truly middleware (like just a utility function), don‚Äôt force it into the middleware chain\nUse async wisely: Database queries and external API calls must use async/await‚Äîblocked event loops are performance killers\nSmart caching: Use in-memory caches like Redis for repeated request caching\nFinal Thoughts Middleware isn‚Äôt just ‚Äúsome functions that run before responses‚Äù‚Äîit‚Äôs actually a performance tuner.\nBy reorganizing into a global ‚Üí route group ‚Üí context ‚Üí handler layered structure, my Node.js server went from struggling under high load to cruising at 40% faster speeds.\nIf your Node.js application is also hitting performance bottlenecks, try rethinking your middleware structure. It might just be the cheapest performance upgrade you ever make.\nHave you tried similar middleware optimizations? Feel free to share your experiences in the comments‚ÄîI‚Äôd love to hear your success stories (or horror stories).\nFollow Dream Beast Programming WeChat official account to unlock more black technologies\n","wordCount":"675","inLanguage":"en","image":"https://rexai.top/cover.png","datePublished":"2025-08-19T23:35:58+08:00","dateModified":"2025-08-19T23:35:58+08:00","author":{"@type":"Person","name":"Dream Beast Programming"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rexai.top/en/js-news/nodejs-middleware-optimization-performance-boost/"},"publisher":{"@type":"Organization","name":"Ê¢¶ÂÖΩÁºñÁ®ã","logo":{"@type":"ImageObject","url":"https://rexai.top/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://rexai.top/en/ accesskey=h title="Ê¢¶ÂÖΩÁºñÁ®ã (Alt + H)">Ê¢¶ÂÖΩÁºñÁ®ã</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://rexai.top/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>Zh-Cn</a></li></ul></div></div><button class=menu-toggle id=menu-toggle aria-label=ÊâìÂºÄËèúÂçï aria-controls=menu aria-expanded=false>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul id=menu role=menubar><li role=none><a href=https://rexai.top/en/ title=Home role=menuitem><span>Home</span></a></li><li class=has-submenu role=none><a href=https://rexai.top/en/tutorials/ title="üìö Tutorials" role=menuitem><span>üìö Tutorials</span>
<span class=submenu-toggle role=button tabindex=0 aria-expanded=false aria-haspopup=true>‚ñº</span></a><ul class=submenu role=menu><li role=none><a href=https://rexai.top/en/tutorials/rust/ title=Rust role=menuitem>Rust</a></li><li role=none><a href=https://rexai.top/en/tutorials/ai/ title="AI Programming" role=menuitem>AI Programming</a></li></ul></li><li role=none><a href=https://rexai.top/en/tools/ title=Tools role=menuitem><span>Tools</span></a></li><li role=none><a href=https://rexai.top/en/news/ title="üî• News" role=menuitem><span>üî• News</span></a></li><li role=none><a href=https://rexai.top/en/tags/ title="üè∑Ô∏è Tags" role=menuitem><span>üè∑Ô∏è Tags</span></a></li><li role=none><a href=https://rexai.top/en/categories/ title="üìÇ Categories" role=menuitem><span>üìÇ Categories</span></a></li></ul><div id=menu-overlay class=menu-overlay hidden></div></nav></header><style>.has-submenu{position:relative}#menu{overflow:visible !important}#menu li{overflow:visible}.submenu{position:absolute;top:100%;left:0;background:var(--theme);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);min-width:180px;z-index:1000;list-style:none;display:none;padding:.5rem 0}.submenu li{display:block;margin:0;line-height:1.5}#menu .submenu li+li{margin-inline-start:0}.submenu a{display:block;padding:.75rem 1rem;color:var(--secondary);text-decoration:none;transition:all .2s ease;border-radius:0}.submenu a:hover{background:var(--entry);color:var(--primary)}.has-submenu:hover .submenu{display:block !important}.submenu-toggle{margin-left:.25rem;font-size:.75rem;transition:transform .2s ease;display:inline-block}.has-submenu:hover .submenu-toggle{transform:rotate(180deg)}@media(max-width:768px){.menu-toggle{display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;margin-inline-end:var(--gap);border-radius:8px;border:1px solid var(--border);background:var(--theme);color:var(--primary)}#menu{position:fixed;top:0;right:0;height:100vh;width:82vw;max-width:340px;background:var(--theme);box-shadow:-2px 0 20px rgba(0,0,0,.18);transform:translateX(100%);transition:transform .25s ease;padding:calc(var(--header-height) + 10px)16px 20px;flex-direction:column;gap:4px;overflow-y:auto !important;z-index:1001}body.menu-open #menu{transform:translateX(0)}.menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:1000}body.menu-open .menu-overlay{opacity:1;pointer-events:auto}#menu li+li{margin-inline-start:0}#menu a{padding:12px 8px}.submenu{position:static;box-shadow:none;border:none;background:var(--entry);margin-top:0;margin-left:1rem;display:block;max-height:0;overflow:hidden;padding:0;transition:max-height .25s ease,padding .2s ease}.has-submenu.active .submenu{max-height:1000px;padding:4px 0 6px}.submenu-toggle{cursor:pointer}.has-submenu.active>a .submenu-toggle{transform:rotate(180deg)}}@media(min-width:769px){.menu-toggle{display:none}}.submenu a:focus-visible,#menu a:focus-visible,.menu-toggle:focus-visible,.submenu-toggle:focus-visible{outline:2px solid var(--primary);outline-offset:2px;border-radius:6px}@media(max-width:768px){#menu a.is-current,#menu a.is-current>span{border-bottom:none !important;background:var(--entry);color:var(--primary);border-radius:8px;font-weight:600}#menu a.is-current{padding:10px}#menu a{width:100%;border-radius:8px}#menu .active{border-bottom:none !important}}body.menu-open{overflow:hidden;touch-action:none}</style><script>(function(){const s=document.getElementById("menu"),t=document.getElementById("menu-toggle"),o=document.getElementById("menu-overlay");if(!s||!t||!o)return;const i=()=>window.innerWidth<=768,r=()=>{document.body.classList.add("menu-open"),t.setAttribute("aria-expanded","true"),o.hidden=!1,l()},n=()=>{document.body.classList.remove("menu-open"),t.setAttribute("aria-expanded","false"),o.hidden=!0,d(),t.focus()};t.addEventListener("click",()=>{const e=document.body.classList.contains("menu-open");e?n():r()}),o.addEventListener("click",n),window.addEventListener("keydown",e=>{e.key==="Escape"&&n()}),window.addEventListener("resize",()=>{window.innerWidth>768&&n()});const c=()=>{const e=Array.from(document.querySelectorAll(".has-submenu")),t=t=>{e.forEach(e=>{if(e!==t&&e.classList.contains("active")){e.classList.remove("active");const t=e.querySelector(".submenu-toggle");t&&t.setAttribute("aria-expanded","false")}})};e.forEach(e=>{const o=e.querySelector("a"),n=e.querySelector(".submenu-toggle"),a=e.querySelector(".submenu");if(!n||!a||!o)return;const r=t=>{n.setAttribute("aria-expanded",t?"true":"false"),e.classList.toggle("active",t)},s=()=>{const n=!e.classList.contains("active");n&&t(e),r(n)};n.addEventListener("click",e=>{if(!i())return;e.preventDefault(),e.stopPropagation(),s()}),n.addEventListener("keydown",e=>{if(!i())return;(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),s())}),o.addEventListener("click",e=>{if(!i())return;e.preventDefault(),e.stopPropagation(),s()})})};let e=[];const a=t=>{if(t.key!=="Tab"||!document.body.classList.contains("menu-open"))return;e=Array.from(s.querySelectorAll('a, button, [tabindex="0"]'));const n=e[0],o=e[e.length-1];if(!n||!o)return;t.shiftKey&&document.activeElement===n?(t.preventDefault(),o.focus()):!t.shiftKey&&document.activeElement===o&&(t.preventDefault(),n.focus())},l=()=>{e=Array.from(s.querySelectorAll('a, button, [tabindex="0"]')),e.length&&e[0].focus(),document.addEventListener("keydown",a)},d=()=>{document.removeEventListener("keydown",a)};c(),s.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element)||!i())return;const s=t.closest("a");if(!s)return;const o=s.closest("li"),a=o&&o.classList.contains("has-submenu");a||n()})})()</script><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">The Middleware Optimization Trick That Made My Node.js Server 40% Faster</h1><div class=post-description>Learn this middleware design pattern to dramatically boost Node.js performance, reduce latency, and improve scalability without rewriting your code</div><div class=post-meta><span title='2025-08-19 23:35:58 +0800 +0800'>August 19, 2025</span>&nbsp;¬∑&nbsp;4 min&nbsp;¬∑&nbsp;675 words&nbsp;¬∑&nbsp;Dream Beast Programming&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/>Zh-Cn</a></li></ul></div></header><figure class=entry-cover><img loading=eager srcset='https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/cover_hu_a2423ab89076f9b7.png 360w,https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/cover_hu_e07957b8d6684b68.png 480w,https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/cover_hu_ec7cac7bb9bc55b3.png 720w,https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/cover_hu_937f2519c848cc87.png 1080w,https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/cover_hu_6dd8df4b4c07174a.png 1500w,https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/cover.png 1536w' src=https://rexai.top/js-news/nodejs-middleware-optimization-performance-boost/cover.png sizes="(min-width: 768px) 720px, 100vw" width=1536 height=1024 alt="Node.js Middleware Optimization Architecture Diagram"><figcaption>Layered middleware architecture boosts server performance by 40%</figcaption></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#what-is-middleware-lets-get-this-concept-clear-first aria-label="What is Middleware? Let&rsquo;s Get This Concept Clear First">What is Middleware? Let&rsquo;s Get This Concept Clear First</a></li><li><a href=#whats-the-problem-the-middleware-mistake-most-people-make aria-label="What&rsquo;s the Problem? The Middleware Mistake Most People Make">What&rsquo;s the Problem? The Middleware Mistake Most People Make</a></li><li><a href=#the-solution-layered-middleware-architecture aria-label="The Solution: Layered Middleware Architecture">The Solution: Layered Middleware Architecture</a></li><li><a href=#why-does-this-make-it-40-faster aria-label="Why Does This Make It 40% Faster?">Why Does This Make It 40% Faster?</a></li><li><a href=#how-did-i-measure-this-40-improvement aria-label="How Did I Measure This 40% Improvement?">How Did I Measure This 40% Improvement?</a></li><li><a href=#a-few-tips-to-make-middleware-faster aria-label="A Few Tips to Make Middleware Faster">A Few Tips to Make Middleware Faster</a></li><li><a href=#final-thoughts aria-label="Final Thoughts">Final Thoughts</a></li></ul></div></details></div><div class=post-content><p>Have you ever been in this situation: your Node.js server is getting slower and slower, users are complaining about page lag, but you don&rsquo;t want to undertake a massive rewrite of your entire project?</p><p>Don&rsquo;t panic! Today I&rsquo;m sharing a &ldquo;lazy but effective&rdquo; optimization approach‚Äîmiddleware refactoring. Using this method, my server performance improved by 40%, and the code became cleaner too.</p><h2 id=what-is-middleware-lets-get-this-concept-clear-first>What is Middleware? Let&rsquo;s Get This Concept Clear First<a hidden class=anchor aria-hidden=true href=#what-is-middleware-lets-get-this-concept-clear-first>#</a></h2><p>Simply put, middleware is like a restaurant server. You order a dish (make a request), the kitchen prepares it (processing logic), but before the dish reaches your table, the server has to do many things:</p><ol><li>Check if the dish is complete (data validation)</li><li>Verify your identity (user authentication)</li><li>Record this service (logging)</li><li>Handle special requests (error handling)</li></ol><p>In Node.js, middleware are these &ldquo;servers,&rdquo; handling various tasks between requests and final responses.</p><p>If you&rsquo;ve used Express.js, you&rsquo;re definitely already using middleware‚Äîyou just might not have realized it.</p><h2 id=whats-the-problem-the-middleware-mistake-most-people-make>What&rsquo;s the Problem? The Middleware Mistake Most People Make<a hidden class=anchor aria-hidden=true href=#whats-the-problem-the-middleware-mistake-most-people-make>#</a></h2><p>My previous code looked like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Every route has to run a bunch of middleware
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/users&#39;</span>, <span style=color:#a6e22e>logRequest</span>, <span style=color:#a6e22e>authCheck</span>, <span style=color:#a6e22e>loadUserData</span>, <span style=color:#a6e22e>getUsers</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/products&#39;</span>, <span style=color:#a6e22e>logRequest</span>, <span style=color:#a6e22e>authCheck</span>, <span style=color:#a6e22e>loadUserData</span>, <span style=color:#a6e22e>fetchProducts</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/public/info&#39;</span>, <span style=color:#a6e22e>logRequest</span>, <span style=color:#a6e22e>authCheck</span>, <span style=color:#a6e22e>loadUserData</span>, <span style=color:#a6e22e>getPublicInfo</span>);
</span></span></code></pre></div><p>See the problem? It&rsquo;s like making every customer go through VIP lounge security, even if they&rsquo;re just going to the regular dining hall for fast food.</p><p>The results of doing this:</p><ol><li><strong>Redundant execution</strong>: The same middleware runs on every route</li><li><strong>Unnecessary overhead</strong>: Public pages also have to load user data</li><li><strong>Debugging nightmare</strong>: When something breaks, you have no idea which step got stuck</li></ol><h2 id=the-solution-layered-middleware-architecture>The Solution: Layered Middleware Architecture<a hidden class=anchor aria-hidden=true href=#the-solution-layered-middleware-architecture>#</a></h2><p>I reorganized middleware into a four-layer structure, just like airport security:</p><p><strong>Global Middleware</strong>: Basic checks everyone has to pass (request parsing, logging)
<strong>Route Group Middleware</strong>: Area-specific checks (like extra security only international flights need)
<strong>Context Middleware</strong>: Situation-specific checks (business class has dedicated lanes)
<strong>Handlers</strong>: Final business logic (boarding)</p><p>Here&rsquo;s how it&rsquo;s implemented:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Global middleware - all requests need this
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>logger</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Public route group - simplest processing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>publicRouter</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>Router</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>publicRouter</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/info&#39;</span>, <span style=color:#a6e22e>getPublicInfo</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>publicRouter</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/docs&#39;</span>, <span style=color:#a6e22e>getDocs</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/public&#39;</span>, <span style=color:#a6e22e>publicRouter</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Private route group - requires authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>privateRouter</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>Router</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>privateRouter</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>authCheck</span>); <span style=color:#75715e>// Only this group needs authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>privateRouter</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>loadUserData</span>); <span style=color:#75715e>// Only this group needs user data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>privateRouter</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/profile&#39;</span>, <span style=color:#a6e22e>getUserProfile</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>privateRouter</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/settings&#39;</span>, <span style=color:#a6e22e>getUserSettings</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/private&#39;</span>, <span style=color:#a6e22e>privateRouter</span>);
</span></span></code></pre></div><h2 id=why-does-this-make-it-40-faster>Why Does This Make It 40% Faster?<a hidden class=anchor aria-hidden=true href=#why-does-this-make-it-40-faster>#</a></h2><p><strong>Reduces unnecessary middleware execution</strong>: Public pages no longer need to load user data, directly saving database queries</p><p><strong>Lowers I/O bottlenecks</strong>: Moves expensive operations (like database queries) to when they&rsquo;re actually needed</p><p><strong>Better cache utilization</strong>: Similar request types can share cache, avoiding duplicate computations</p><p>It&rsquo;s like highway ETC lanes‚Äîdifferent types of vehicles use different lanes, naturally improving overall traffic efficiency.</p><h2 id=how-did-i-measure-this-40-improvement>How Did I Measure This 40% Improvement?<a hidden class=anchor aria-hidden=true href=#how-did-i-measure-this-40-improvement>#</a></h2><p>Data doesn&rsquo;t lie. I used these tools:</p><p><strong>Apache Benchmark (ab)</strong>: Simulating high-concurrency requests
<strong>New Relic</strong>: Real-time performance monitoring</p><p>Before optimization:</p><ul><li>Average response time: 450ms</li><li>Concurrent processing capacity: 200 req/s</li><li>CPU usage: 75%</li></ul><p>After optimization:</p><ul><li>Average response time: 270ms (40% improvement)</li><li>Concurrent processing capacity: 350 req/s (75% improvement)</li><li>CPU usage: 45% (40% reduction)</li></ul><h2 id=a-few-tips-to-make-middleware-faster>A Few Tips to Make Middleware Faster<a hidden class=anchor aria-hidden=true href=#a-few-tips-to-make-middleware-faster>#</a></h2><p><strong>Order matters</strong>: Put lightweight, frequently used middleware first, and heavy, rarely used middleware last</p><p><strong>Avoid middleware bloat</strong>: If a function isn&rsquo;t truly middleware (like just a utility function), don&rsquo;t force it into the middleware chain</p><p><strong>Use async wisely</strong>: Database queries and external API calls must use async/await‚Äîblocked event loops are performance killers</p><p><strong>Smart caching</strong>: Use in-memory caches like Redis for repeated request caching</p><h2 id=final-thoughts>Final Thoughts<a hidden class=anchor aria-hidden=true href=#final-thoughts>#</a></h2><p>Middleware isn&rsquo;t just &ldquo;some functions that run before responses&rdquo;‚Äîit&rsquo;s actually a performance tuner.</p><p>By reorganizing into a <strong>global ‚Üí route group ‚Üí context ‚Üí handler</strong> layered structure, my Node.js server went from struggling under high load to cruising at 40% faster speeds.</p><p>If your Node.js application is also hitting performance bottlenecks, try rethinking your middleware structure. It might just be the cheapest performance upgrade you ever make.</p><p>Have you tried similar middleware optimizations? Feel free to share your experiences in the comments‚ÄîI&rsquo;d love to hear your success stories (or horror stories).</p><p>Follow Dream Beast Programming WeChat official account to unlock more black technologies</p></div><section class=post-actions aria-label="post actions"><div class=post-actions__group><div class=post-actions__item><script type=text/javascript src=https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js data-name=bmc-button data-slug=winbbryz data-color=#FFDD00 data-emoji data-font=Cookie data-text="Buy me a coffee" data-outline-color=#000000 data-font-color=#000000 data-coffee-color=#ffffff></script></div></div></section><footer class=post-footer><ul class=post-tags><li><a href=https://rexai.top/en/tags/node.js/>Node.js</a></li><li><a href=https://rexai.top/en/tags/middleware/>Middleware</a></li><li><a href=https://rexai.top/en/tags/performance-optimization/>Performance Optimization</a></li><li><a href=https://rexai.top/en/tags/backend-development/>Backend Development</a></li></ul></footer></article></main><footer class=footer><span>¬© <a href=https://rexai.top/>Ê¢¶ÂÖΩÁºñÁ®ã</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>