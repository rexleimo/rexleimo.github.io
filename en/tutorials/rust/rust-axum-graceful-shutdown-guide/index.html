<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rust Axum Graceful Shutdown: The Ultimate Guide | 梦兽编程</title><meta name=keywords content="Rust,Axum,Graceful Shutdown,Tokio,Web Development,Backend"><meta name=description content="Discover the importance and implementation of graceful shutdown in Rust Axum web applications. This guide covers signal handling, proper server termination, and best practices for ensuring zero-downtime deployments and data integrity."><meta name=author content="Rexai Programming"><link rel=canonical href=https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/><link crossorigin=anonymous href=/assets/css/stylesheet.36a35dd316f612e0d26c90cd90313d15705d24943d7cf2559674e92b21704616.css integrity="sha256-NqNd0xb2EuDSbJDNkDE9FXBdJJQ9fPJVlnTpKyFwRhY=" rel="preload stylesheet" as=style><link rel=icon href=https://rexai.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rexai.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rexai.top/favicon-32x32.png><link rel=apple-touch-icon href=https://rexai.top/apple-touch-icon.png><link rel=mask-icon href=https://rexai.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/><link rel=alternate hreflang=en href=https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/css/extended/modern-typography.min.css integrity><style>.promotion-section{margin-top:3rem;padding:2rem;text-align:center;background:linear-gradient(135deg,rgba(59,130,246,5%) 0%,rgba(139,92,246,5%) 100%);border-radius:16px;border:1px solid rgba(59,130,246,.1);position:relative;overflow:hidden}.promotion-section::before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#06b6d4);border-radius:16px 16px 0 0}.promotion-section h3{margin-bottom:1.5rem;color:var(--primary);font-size:1.5rem;font-weight:600;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.qr-codes{display:flex;gap:2.5rem;justify-content:center;flex-wrap:wrap;margin-top:2rem}.qr-item{text-align:center;position:relative;transition:transform .3s ease}.qr-item:hover{transform:translateY(-5px)}.qr-item img{width:160px;height:160px;border:2px solid #e5e7eb;border-radius:16px;padding:12px;background:#fff;box-shadow:0 4px 20px rgba(0,0,0,8%),0 1px 3px rgba(0,0,0,.1);transition:all .3s ease;position:relative;overflow:hidden}.qr-item img::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(59,130,246,.1),rgba(139,92,246,.1));opacity:0;transition:opacity .3s ease;z-index:1}.qr-item:hover img{border-color:#3b82f6;box-shadow:0 8px 30px rgba(59,130,246,.2),0 2px 8px rgba(0,0,0,.1);transform:scale(1.02)}.qr-item:hover img::before{opacity:1}.qr-item p{margin-top:1rem;font-size:1rem;color:var(--secondary);font-weight:500;position:relative}.modern-button{display:inline-flex;align-items:center;padding:.75rem 1.5rem;background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;text-decoration:none;border-radius:12px;font-weight:500;transition:all .3s ease;box-shadow:0 4px 12px rgba(59,130,246,.3);position:relative;overflow:hidden}.modern-button::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .6s ease}.modern-button:hover::before{left:100%}.modern-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(59,130,246,.4)}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.post-content>*{animation:fadeInUp .6s ease-out;animation-fill-mode:both}.post-content>*:nth-child(1){animation-delay:.1s}.post-content>*:nth-child(2){animation-delay:.2s}.post-content>*:nth-child(3){animation-delay:.3s}.post-content>*:nth-child(4){animation-delay:.4s}@media(max-width:768px){.promotion-section{margin:2rem -1rem;border-radius:0;padding:1.5rem 1rem}.qr-codes{flex-direction:column;align-items:center;gap:1.5rem}.qr-item img{width:140px;height:140px;padding:10px}.promotion-section h3{font-size:1.25rem}}.reading-progress{position:fixed;top:0;left:0;width:0%;height:3px;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#06b6d4);z-index:999;transition:width .1s ease}.post-actions{margin-top:2.5rem;padding-top:1.25rem;border-top:1px dashed var(--border)}.post-actions__group{display:flex;flex-wrap:wrap;gap:.75rem 1rem;align-items:center}.post-actions__item{display:inline-flex;align-items:center}*{transition:background-color .3s ease,color .3s ease,border-color .3s ease}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:var(--theme)}::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#2563eb,#7c3aed)}</style><script>document.addEventListener("DOMContentLoaded",function(){const e=document.createElement("div");e.className="reading-progress",document.body.appendChild(e);function t(){const t=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,s=t/n*100;e.style.width=s+"%"}window.addEventListener("scroll",t),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})})})</script><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-K6VQRF8T")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K6VQRF8T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-62VF26DEY6"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-62VF26DEY6")</script><meta property="og:url" content="https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/"><meta property="og:site_name" content="梦兽编程"><meta property="og:title" content="Rust Axum Graceful Shutdown: The Ultimate Guide"><meta property="og:description" content="Discover the importance and implementation of graceful shutdown in Rust Axum web applications. This guide covers signal handling, proper server termination, and best practices for ensuring zero-downtime deployments and data integrity."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2025-08-17T14:00:00+08:00"><meta property="article:modified_time" content="2025-08-17T14:00:00+08:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Axum"><meta property="article:tag" content="Graceful Shutdown"><meta property="article:tag" content="Tokio"><meta property="article:tag" content="Web Development"><meta property="article:tag" content="Backend"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust Axum Graceful Shutdown: The Ultimate Guide"><meta name=twitter:description content="Discover the importance and implementation of graceful shutdown in Rust Axum web applications. This guide covers signal handling, proper server termination, and best practices for ensuring zero-downtime deployments and data integrity."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorials","item":"https://rexai.top/en/tutorials/"},{"@type":"ListItem","position":2,"name":"Rust Axum Graceful Shutdown: The Ultimate Guide","item":"https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rust Axum Graceful Shutdown: The Ultimate Guide","name":"Rust Axum Graceful Shutdown: The Ultimate Guide","description":"Discover the importance and implementation of graceful shutdown in Rust Axum web applications. This guide covers signal handling, proper server termination, and best practices for ensuring zero-downtime deployments and data integrity.","keywords":["Rust","Axum","Graceful Shutdown","Tokio","Web Development","Backend"],"articleBody":"Stop Using Ctrl+C Violently! Let Me Teach You How to Give Your Axum Server a “Five-Star” Graceful Exit.\nAre you one of those developers? You build an awesome Axum service, run it, and feel like the king of the world. But when it’s time to stop it, you hit Ctrl+C without a second thought. Simple, brutal, effective.\nIt feels good, but do you know what’s happening behind the scenes?\nImagine you own a bustling restaurant. At 10 PM, you’re ready to close. You don’t just cut the power and lock the doors, kicking out customers who are still eating. If you did, your restaurant would be trending tomorrow for “terrible service.”\nThe right way is to hang a “Closed for today” sign (no new customers), let the current guests finish their meals (process ongoing requests), clean up the kitchen (release resources), and only then, lock the doors and go home.\nToday, I’ll guide you through implementing a five-star closing procedure for your “restaurant” using Rust and Axum—Graceful Shutdown.\nStep 1: We Need a “Signal Handler” First, our application needs to understand commands. It can’t keep running when the operating system says, “Time to wrap up.” These commands are signals like SIGINT (sent when you press Ctrl+C) and SIGTERM (sent by systems or tools like Docker).\nIn Tokio, we can set up a shutdown_signal function to listen specifically for these two signals.\nuse tokio::signal; async fn shutdown_signal() { let ctrl_c = async { signal::ctrl_c() .await .expect(\"failed to install Ctrl+C handler\"); }; #[cfg(unix)] let terminate = async { signal::unix::signal(signal::unix::SignalKind::terminate()) .expect(\"failed to install signal handler\") .recv() .await; }; #[cfg(not(unix))] let terminate = std::future::pending::\u003c()\u003e(); tokio::select! { _ = ctrl_c =\u003e {}, _ = terminate =\u003e {}, } println!(\"Signal received, starting graceful shutdown...\"); } This code is like installing a voice-activated switch at your restaurant’s entrance. It triggers the next step as soon as it hears “Closing time!”\nStep 2: The Professionalism of an Axum Server Just having a signal handler isn’t enough. Our Axum server needs to know what to do when it receives the signal.\nAxum provides a fantastic method called with_graceful_shutdown. You just pass our shutdown_signal to it, and it immediately understands: “Okay, it’s time to close.”\nFrom that moment, it will politely refuse all new customers (stop accepting new connections) while patiently waiting for the current guests to finish their meals (process all ongoing requests).\nStep 3: Don’t Forget the “Chefs” in the Back If your service has background asynchronous tasks (like scheduled jobs or data processing), they are like the chefs in the kitchen. When the restaurant is closing, you need to notify them to finish up and clean their stations.\nThis is where CancellationToken comes in. It acts like a “closing bell.” In our main process, we hold the controller and pass a “clone” to each background task. When it’s time to shut down, we trigger the controller, and all the clones will ring.\nHere’s how a “chef” works:\nuse tokio_util::sync::CancellationToken; async fn background_task(token: CancellationToken) { while !token.is_cancelled() { println!(\"Background chef is cooking...\"); tokio::select! { _ = tokio::time::sleep(std::time::Duration::from_secs(1)) =\u003e {} _ = token.cancelled() =\u003e { // The closing bell rang, stop cooking. break; } } } println!(\"Chef has cleaned the kitchen and is going home!\"); } Final Act: The Perfect Closing Scene Alright, we have our actors and script. Let’s assemble everything and see the “closing scene” unfold:\nuse axum::{routing::get, Router}; use tokio::net::TcpListener; use tokio_util::sync::CancellationToken; // ... background_task from above ... // ... shutdown_signal from above ... async fn hello() -\u003e \u0026'static str { \"Hello, World!\" } #[tokio::main] async fn main() { let app = Router::new().route(\"/\", get(hello)); // This is the controller for the closing bell let cancellation_token = CancellationToken::new(); let token_clone = cancellation_token.clone(); // Assign a chef to the kitchen and give them a closing bell clone let background_handle = tokio::spawn(background_task(token_clone)); // Listen and serve (Axum 0.7 style) let listener = TcpListener::bind((\"127.0.0.1\", 3000)).await.unwrap(); println!(\"Restaurant open for business, listening on {:?}\", listener.local_addr().unwrap()); axum::serve(listener, app) .with_graceful_shutdown(shutdown_signal()) .await .unwrap(); // After the server's shift ends, ring the bell for the chef cancellation_token.cancel(); // Wait for the chef to clean the kitchen if let Err(e) = background_handle.await { eprintln!(\"The chef had some trouble on the way home: {}\", e); } println!(\"Restaurant closed perfectly. Everyone is home safe!\"); } In Summary With just a few steps, your Axum service transforms from a “brash youth” into a “mature adult” that knows how to start and end things properly. This isn’t just about elegant code; it’s about professionalism and responsibility towards your users and their data.\nThe next time a hiring manager asks, you can tell them the story of the closing restaurant. It’s sure to impress.\n","wordCount":"772","inLanguage":"en","datePublished":"2025-08-17T14:00:00+08:00","dateModified":"2025-08-17T14:00:00+08:00","author":{"@type":"Person","name":"Rexai Programming"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/"},"publisher":{"@type":"Organization","name":"梦兽编程","logo":{"@type":"ImageObject","url":"https://rexai.top/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://rexai.top/en/ accesskey=h title="梦兽编程 (Alt + H)">梦兽编程</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://rexai.top/ title=中文 aria-label=中文>Zh-Cn</a></li></ul></div></div><button class=menu-toggle id=menu-toggle aria-label=打开菜单 aria-controls=menu aria-expanded=false>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul id=menu role=menubar><li role=none><a href=https://rexai.top/en/ title=Home role=menuitem><span>Home</span></a></li><li class=has-submenu role=none><a href=https://rexai.top/en/tutorials/ title="📚 Tutorials" role=menuitem><span>📚 Tutorials</span>
<span class=submenu-toggle role=button tabindex=0 aria-expanded=false aria-haspopup=true>▼</span></a><ul class=submenu role=menu><li role=none><a href=https://rexai.top/en/tutorials/rust/ title=Rust role=menuitem>Rust</a></li><li role=none><a href=https://rexai.top/en/tutorials/ai/ title="AI Programming" role=menuitem>AI Programming</a></li></ul></li><li role=none><a href=https://rexai.top/en/tools/ title=Tools role=menuitem><span>Tools</span></a></li><li role=none><a href=https://rexai.top/en/news/ title="🔥 News" role=menuitem><span>🔥 News</span></a></li><li role=none><a href=https://rexai.top/en/tags/ title="🏷️ Tags" role=menuitem><span>🏷️ Tags</span></a></li><li role=none><a href=https://rexai.top/en/categories/ title="📂 Categories" role=menuitem><span>📂 Categories</span></a></li></ul><div id=menu-overlay class=menu-overlay hidden></div></nav></header><style>.has-submenu{position:relative}#menu{overflow:visible !important}#menu li{overflow:visible}.submenu{position:absolute;top:100%;left:0;background:var(--theme);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);min-width:180px;z-index:1000;list-style:none;display:none;padding:.5rem 0}.submenu li{display:block;margin:0;line-height:1.5}#menu .submenu li+li{margin-inline-start:0}.submenu a{display:block;padding:.75rem 1rem;color:var(--secondary);text-decoration:none;transition:all .2s ease;border-radius:0}.submenu a:hover{background:var(--entry);color:var(--primary)}.has-submenu:hover .submenu{display:block !important}.submenu-toggle{margin-left:.25rem;font-size:.75rem;transition:transform .2s ease;display:inline-block}.has-submenu:hover .submenu-toggle{transform:rotate(180deg)}@media(max-width:768px){.menu-toggle{display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;margin-inline-end:var(--gap);border-radius:8px;border:1px solid var(--border);background:var(--theme);color:var(--primary)}#menu{position:fixed;top:0;right:0;height:100vh;width:82vw;max-width:340px;background:var(--theme);box-shadow:-2px 0 20px rgba(0,0,0,.18);transform:translateX(100%);transition:transform .25s ease;padding:calc(var(--header-height) + 10px)16px 20px;flex-direction:column;gap:4px;overflow-y:auto !important;z-index:1001}body.menu-open #menu{transform:translateX(0)}.menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:1000}body.menu-open .menu-overlay{opacity:1;pointer-events:auto}#menu li+li{margin-inline-start:0}#menu a{padding:12px 8px}.submenu{position:static;box-shadow:none;border:none;background:var(--entry);margin-top:0;margin-left:1rem;display:block;max-height:0;overflow:hidden;padding:0;transition:max-height .25s ease,padding .2s ease}.has-submenu.active .submenu{max-height:1000px;padding:4px 0 6px}.submenu-toggle{cursor:pointer}.has-submenu.active>a .submenu-toggle{transform:rotate(180deg)}}@media(min-width:769px){.menu-toggle{display:none}}.submenu a:focus-visible,#menu a:focus-visible,.menu-toggle:focus-visible,.submenu-toggle:focus-visible{outline:2px solid var(--primary);outline-offset:2px;border-radius:6px}@media(max-width:768px){#menu a.is-current,#menu a.is-current>span{border-bottom:none !important;background:var(--entry);color:var(--primary);border-radius:8px;font-weight:600}#menu a.is-current{padding:10px}#menu a{width:100%;border-radius:8px}#menu .active{border-bottom:none !important}}body.menu-open{overflow:hidden;touch-action:none}</style><script>(function(){const s=document.getElementById("menu"),t=document.getElementById("menu-toggle"),o=document.getElementById("menu-overlay");if(!s||!t||!o)return;const i=()=>window.innerWidth<=768,r=()=>{document.body.classList.add("menu-open"),t.setAttribute("aria-expanded","true"),o.hidden=!1,l()},n=()=>{document.body.classList.remove("menu-open"),t.setAttribute("aria-expanded","false"),o.hidden=!0,d(),t.focus()};t.addEventListener("click",()=>{const e=document.body.classList.contains("menu-open");e?n():r()}),o.addEventListener("click",n),window.addEventListener("keydown",e=>{e.key==="Escape"&&n()}),window.addEventListener("resize",()=>{window.innerWidth>768&&n()});const c=()=>{const e=Array.from(document.querySelectorAll(".has-submenu")),t=t=>{e.forEach(e=>{if(e!==t&&e.classList.contains("active")){e.classList.remove("active");const t=e.querySelector(".submenu-toggle");t&&t.setAttribute("aria-expanded","false")}})};e.forEach(e=>{const o=e.querySelector("a"),n=e.querySelector(".submenu-toggle"),a=e.querySelector(".submenu");if(!n||!a||!o)return;const r=t=>{n.setAttribute("aria-expanded",t?"true":"false"),e.classList.toggle("active",t)},s=()=>{const n=!e.classList.contains("active");n&&t(e),r(n)};n.addEventListener("click",e=>{if(!i())return;e.preventDefault(),e.stopPropagation(),s()}),n.addEventListener("keydown",e=>{if(!i())return;(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),s())}),o.addEventListener("click",e=>{if(!i())return;e.preventDefault(),e.stopPropagation(),s()})})};let e=[];const a=t=>{if(t.key!=="Tab"||!document.body.classList.contains("menu-open"))return;e=Array.from(s.querySelectorAll('a, button, [tabindex="0"]'));const n=e[0],o=e[e.length-1];if(!n||!o)return;t.shiftKey&&document.activeElement===n?(t.preventDefault(),o.focus()):!t.shiftKey&&document.activeElement===o&&(t.preventDefault(),n.focus())},l=()=>{e=Array.from(s.querySelectorAll('a, button, [tabindex="0"]')),e.length&&e[0].focus(),document.addEventListener("keydown",a)},d=()=>{document.removeEventListener("keydown",a)};c(),s.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element)||!i())return;const s=t.closest("a");if(!s)return;const o=s.closest("li"),a=o&&o.classList.contains("has-submenu");a||n()})})()</script><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Rust Axum Graceful Shutdown: The Ultimate Guide</h1><div class=post-description>Discover the importance and implementation of graceful shutdown in Rust Axum web applications. This guide covers signal handling, proper server termination, and best practices for ensuring zero-downtime deployments and data integrity.</div><div class=post-meta><span title='2025-08-17 14:00:00 +0800 +0800'>August 17, 2025</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;772 words&nbsp;·&nbsp;Rexai Programming&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/>Zh-Cn</a></li></ul></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#step-1-we-need-a aria-label="Step 1: We Need a &ldquo;Signal Handler&rdquo;">Step 1: We Need a &ldquo;Signal Handler&rdquo;</a></li><li><a href=#step-2-the-professionalism-of-an-axum-server aria-label="Step 2: The Professionalism of an Axum Server">Step 2: The Professionalism of an Axum Server</a></li><li><a href=#step-3-don aria-label="Step 3: Don&rsquo;t Forget the &ldquo;Chefs&rdquo; in the Back">Step 3: Don&rsquo;t Forget the &ldquo;Chefs&rdquo; in the Back</a></li><li><a href=#final-act-the-perfect-closing-scene aria-label="Final Act: The Perfect Closing Scene">Final Act: The Perfect Closing Scene</a></li><li><a href=#in-summary aria-label="In Summary">In Summary</a></li></ul></div></details></div><div class=post-content><p>Stop Using <code>Ctrl+C</code> Violently! Let Me Teach You How to Give Your Axum Server a &ldquo;Five-Star&rdquo; Graceful Exit.</p><hr><p>Are you one of those developers? You build an awesome Axum service, run it, and feel like the king of the world. But when it&rsquo;s time to stop it, you hit <code>Ctrl+C</code> without a second thought. Simple, brutal, effective.</p><p>It feels good, but do you know what&rsquo;s happening behind the scenes?</p><p>Imagine you own a bustling restaurant. At 10 PM, you&rsquo;re ready to close. You don&rsquo;t just cut the power and lock the doors, kicking out customers who are still eating. If you did, your restaurant would be trending tomorrow for &ldquo;terrible service.&rdquo;</p><p>The right way is to hang a &ldquo;Closed for today&rdquo; sign (no new customers), let the current guests finish their meals (process ongoing requests), clean up the kitchen (release resources), and only then, lock the doors and go home.</p><p>Today, I&rsquo;ll guide you through implementing a five-star closing procedure for your &ldquo;restaurant&rdquo; using Rust and Axum—<strong>Graceful Shutdown</strong>.</p><h2 id=step-1-we-need-a><strong>Step 1: We Need a &ldquo;Signal Handler&rdquo;</strong><a hidden class=anchor aria-hidden=true href=#step-1-we-need-a>#</a></h2><p>First, our application needs to understand commands. It can&rsquo;t keep running when the operating system says, &ldquo;Time to wrap up.&rdquo; These commands are signals like <code>SIGINT</code> (sent when you press <code>Ctrl+C</code>) and <code>SIGTERM</code> (sent by systems or tools like Docker).</p><p>In Tokio, we can set up a <code>shutdown_signal</code> function to listen specifically for these two signals.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::signal;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>shutdown_signal</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> ctrl_c <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>        signal::ctrl_c()
</span></span><span style=display:flex><span>            .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span>            .expect(<span style=color:#e6db74>&#34;failed to install Ctrl+C handler&#34;</span>);
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[cfg(unix)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> terminate <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>        signal::unix::signal(signal::unix::SignalKind::terminate())
</span></span><span style=display:flex><span>            .expect(<span style=color:#e6db74>&#34;failed to install signal handler&#34;</span>)
</span></span><span style=display:flex><span>            .recv()
</span></span><span style=display:flex><span>            .<span style=color:#66d9ef>await</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[cfg(not(unix))]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> terminate <span style=color:#f92672>=</span> std::future::pending::<span style=color:#f92672>&lt;</span>()<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    tokio::<span style=color:#a6e22e>select!</span> {
</span></span><span style=display:flex><span>        _ <span style=color:#f92672>=</span> ctrl_c <span style=color:#f92672>=&gt;</span> {},
</span></span><span style=display:flex><span>        _ <span style=color:#f92672>=</span> terminate <span style=color:#f92672>=&gt;</span> {},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Signal received, starting graceful shutdown...&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This code is like installing a voice-activated switch at your restaurant&rsquo;s entrance. It triggers the next step as soon as it hears &ldquo;Closing time!&rdquo;</p><h2 id=step-2-the-professionalism-of-an-axum-server><strong>Step 2: The Professionalism of an Axum Server</strong><a hidden class=anchor aria-hidden=true href=#step-2-the-professionalism-of-an-axum-server>#</a></h2><p>Just having a signal handler isn&rsquo;t enough. Our Axum server needs to know what to do when it receives the signal.</p><p>Axum provides a fantastic method called <code>with_graceful_shutdown</code>. You just pass our <code>shutdown_signal</code> to it, and it immediately understands: &ldquo;Okay, it&rsquo;s time to close.&rdquo;</p><p>From that moment, it will politely refuse all new customers (stop accepting new connections) while patiently waiting for the current guests to finish their meals (process all ongoing requests).</p><h2 id=step-3-don><strong>Step 3: Don&rsquo;t Forget the &ldquo;Chefs&rdquo; in the Back</strong><a hidden class=anchor aria-hidden=true href=#step-3-don>#</a></h2><p>If your service has background asynchronous tasks (like scheduled jobs or data processing), they are like the chefs in the kitchen. When the restaurant is closing, you need to notify them to finish up and clean their stations.</p><p>This is where <code>CancellationToken</code> comes in. It acts like a &ldquo;closing bell.&rdquo; In our main process, we hold the controller and pass a &ldquo;clone&rdquo; to each background task. When it&rsquo;s time to shut down, we trigger the controller, and all the clones will ring.</p><p>Here&rsquo;s how a &ldquo;chef&rdquo; works:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio_util::sync::CancellationToken;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>background_task</span>(token: <span style=color:#a6e22e>CancellationToken</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#f92672>!</span>token.is_cancelled() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Background chef is cooking...&#34;</span>);
</span></span><span style=display:flex><span>        tokio::<span style=color:#a6e22e>select!</span> {
</span></span><span style=display:flex><span>            _ <span style=color:#f92672>=</span> tokio::time::sleep(std::time::Duration::from_secs(<span style=color:#ae81ff>1</span>)) <span style=color:#f92672>=&gt;</span> {}
</span></span><span style=display:flex><span>            _ <span style=color:#f92672>=</span> token.cancelled() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// The closing bell rang, stop cooking.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Chef has cleaned the kitchen and is going home!&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=final-act-the-perfect-closing-scene><strong>Final Act: The Perfect Closing Scene</strong><a hidden class=anchor aria-hidden=true href=#final-act-the-perfect-closing-scene>#</a></h2><p>Alright, we have our actors and script. Let&rsquo;s assemble everything and see the &ldquo;closing scene&rdquo; unfold:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> axum::{routing::get, Router};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::net::TcpListener;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio_util::sync::CancellationToken;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ... background_task from above ...
</span></span></span><span style=display:flex><span><span style=color:#75715e>// ... shutdown_signal from above ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>hello</span>() -&gt; <span style=color:#66d9ef>&amp;</span>&#39;static <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Hello, World!&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> app <span style=color:#f92672>=</span> Router::new().route(<span style=color:#e6db74>&#34;/&#34;</span>, get(hello));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// This is the controller for the closing bell
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> cancellation_token <span style=color:#f92672>=</span> CancellationToken::new();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> token_clone <span style=color:#f92672>=</span> cancellation_token.clone();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Assign a chef to the kitchen and give them a closing bell clone
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> background_handle <span style=color:#f92672>=</span> tokio::spawn(background_task(token_clone));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Listen and serve (Axum 0.7 style)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> listener <span style=color:#f92672>=</span> TcpListener::bind((<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#ae81ff>3000</span>)).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Restaurant open for business, listening on </span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>, listener.local_addr().unwrap());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    axum::serve(listener, app)
</span></span><span style=display:flex><span>        .with_graceful_shutdown(shutdown_signal())
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span>        .unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// After the server&#39;s shift ends, ring the bell for the chef
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    cancellation_token.cancel();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Wait for the chef to clean the kitchen
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Err(e) <span style=color:#f92672>=</span> background_handle.<span style=color:#66d9ef>await</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>eprintln!</span>(<span style=color:#e6db74>&#34;The chef had some trouble on the way home: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, e);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Restaurant closed perfectly. Everyone is home safe!&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=in-summary><strong>In Summary</strong><a hidden class=anchor aria-hidden=true href=#in-summary>#</a></h2><p>With just a few steps, your Axum service transforms from a &ldquo;brash youth&rdquo; into a &ldquo;mature adult&rdquo; that knows how to start and end things properly. This isn&rsquo;t just about elegant code; it&rsquo;s about professionalism and responsibility towards your users and their data.</p><p>The next time a hiring manager asks, you can tell them the story of the closing restaurant. It&rsquo;s sure to impress.</p></div><section class=post-actions aria-label="post actions"><div class=post-actions__group><div class=post-actions__item><script type=text/javascript src=https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js data-name=bmc-button data-slug=winbbryz data-color=#FFDD00 data-emoji data-font=Cookie data-text="Buy me a coffee" data-outline-color=#000000 data-font-color=#000000 data-coffee-color=#ffffff></script></div></div></section><footer class=post-footer><ul class=post-tags><li><a href=https://rexai.top/en/tags/rust/>Rust</a></li><li><a href=https://rexai.top/en/tags/axum/>Axum</a></li><li><a href=https://rexai.top/en/tags/graceful-shutdown/>Graceful Shutdown</a></li><li><a href=https://rexai.top/en/tags/tokio/>Tokio</a></li><li><a href=https://rexai.top/en/tags/web-development/>Web Development</a></li><li><a href=https://rexai.top/en/tags/backend/>Backend</a></li></ul></footer></article></main><footer class=footer><span>© <a href=https://rexai.top/>梦兽编程</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>