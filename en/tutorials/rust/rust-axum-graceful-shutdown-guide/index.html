<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit | Ê¢¶ÂÖΩÁºñÁ®ã</title><meta name=keywords content="Rust,Axum,Tokio,Graceful Shutdown,SIGTERM,SIGINT,CancellationToken,Kubernetes,Docker,production,microservice,backend"><meta name=description content="Master graceful shutdown for Rust Axum services: listen for SIGINT/SIGTERM, refuse new connections with with_graceful_shutdown, stop background tasks via CancellationToken, set timeouts, and integrate with Docker/Kubernetes termination ‚Äî protect data integrity and user experience."><meta name=author content="Rexai Programming"><link rel=canonical href=https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/><link crossorigin=anonymous href=/assets/css/stylesheet.36a35dd316f612e0d26c90cd90313d15705d24943d7cf2559674e92b21704616.css integrity="sha256-NqNd0xb2EuDSbJDNkDE9FXBdJJQ9fPJVlnTpKyFwRhY=" rel="preload stylesheet" as=style><link rel=icon href=https://rexai.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rexai.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rexai.top/favicon-32x32.png><link rel=apple-touch-icon href=https://rexai.top/apple-touch-icon.png><link rel=mask-icon href=https://rexai.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/><link rel=alternate hreflang=en href=https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/css/extended/modern-typography.min.css integrity><style>.promotion-section{margin-top:3rem;padding:2rem;text-align:center;background:linear-gradient(135deg,rgba(59,130,246,5%) 0%,rgba(139,92,246,5%) 100%);border-radius:16px;border:1px solid rgba(59,130,246,.1);position:relative;overflow:hidden}.promotion-section::before{content:"";position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#06b6d4);border-radius:16px 16px 0 0}.promotion-section h3{margin-bottom:1.5rem;color:var(--primary);font-size:1.5rem;font-weight:600;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.qr-codes{display:flex;gap:2.5rem;justify-content:center;flex-wrap:wrap;margin-top:2rem}.qr-item{text-align:center;position:relative;transition:transform .3s ease}.qr-item:hover{transform:translateY(-5px)}.qr-item img{width:160px;height:160px;border:2px solid #e5e7eb;border-radius:16px;padding:12px;background:#fff;box-shadow:0 4px 20px rgba(0,0,0,8%),0 1px 3px rgba(0,0,0,.1);transition:all .3s ease;position:relative;overflow:hidden}.qr-item img::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,rgba(59,130,246,.1),rgba(139,92,246,.1));opacity:0;transition:opacity .3s ease;z-index:1}.qr-item:hover img{border-color:#3b82f6;box-shadow:0 8px 30px rgba(59,130,246,.2),0 2px 8px rgba(0,0,0,.1);transform:scale(1.02)}.qr-item:hover img::before{opacity:1}.qr-item p{margin-top:1rem;font-size:1rem;color:var(--secondary);font-weight:500;position:relative}.modern-button{display:inline-flex;align-items:center;padding:.75rem 1.5rem;background:linear-gradient(135deg,#3b82f6,#8b5cf6);color:#fff;text-decoration:none;border-radius:12px;font-weight:500;transition:all .3s ease;box-shadow:0 4px 12px rgba(59,130,246,.3);position:relative;overflow:hidden}.modern-button::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .6s ease}.modern-button:hover::before{left:100%}.modern-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(59,130,246,.4)}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}.post-content>*{animation:fadeInUp .6s ease-out;animation-fill-mode:both}.post-content>*:nth-child(1){animation-delay:.1s}.post-content>*:nth-child(2){animation-delay:.2s}.post-content>*:nth-child(3){animation-delay:.3s}.post-content>*:nth-child(4){animation-delay:.4s}@media(max-width:768px){.promotion-section{margin:2rem -1rem;border-radius:0;padding:1.5rem 1rem}.qr-codes{flex-direction:column;align-items:center;gap:1.5rem}.qr-item img{width:140px;height:140px;padding:10px}.promotion-section h3{font-size:1.25rem}}.reading-progress{position:fixed;top:0;left:0;width:0%;height:3px;background:linear-gradient(90deg,#3b82f6,#8b5cf6,#06b6d4);z-index:999;transition:width .1s ease}.post-actions{margin-top:2.5rem;padding-top:1.25rem;border-top:1px dashed var(--border)}.post-actions__group{display:flex;flex-wrap:wrap;gap:.75rem 1rem;align-items:center}.post-actions__item{display:inline-flex;align-items:center}*{transition:background-color .3s ease,color .3s ease,border-color .3s ease}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:var(--theme)}::-webkit-scrollbar-thumb{background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,#2563eb,#7c3aed)}</style><script>document.addEventListener("DOMContentLoaded",function(){const e=document.createElement("div");e.className="reading-progress",document.body.appendChild(e);function t(){const t=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,s=t/n*100;e.style.width=s+"%"}window.addEventListener("scroll",t),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));t&&t.scrollIntoView({behavior:"smooth",block:"start"})})})})</script><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-K6VQRF8T")</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K6VQRF8T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-62VF26DEY6"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-62VF26DEY6")</script><meta property="og:url" content="https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/"><meta property="og:site_name" content="Ê¢¶ÂÖΩÁºñÁ®ã"><meta property="og:title" content="Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit"><meta property="og:description" content="Master graceful shutdown for Rust Axum services: listen for SIGINT/SIGTERM, refuse new connections with with_graceful_shutdown, stop background tasks via CancellationToken, set timeouts, and integrate with Docker/Kubernetes termination ‚Äî protect data integrity and user experience."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2025-08-17T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-17T00:00:00+00:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Axum"><meta property="article:tag" content="Tokio"><meta property="article:tag" content="Backend"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="Graceful Shutdown"><meta property="og:image" content="https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/conver.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/conver.png"><meta name=twitter:title content="Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit"><meta name=twitter:description content="Master graceful shutdown for Rust Axum services: listen for SIGINT/SIGTERM, refuse new connections with with_graceful_shutdown, stop background tasks via CancellationToken, set timeouts, and integrate with Docker/Kubernetes termination ‚Äî protect data integrity and user experience."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorials","item":"https://rexai.top/en/tutorials/"},{"@type":"ListItem","position":2,"name":"Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit","item":"https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit","name":"Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit","description":"Master graceful shutdown for Rust Axum services: listen for SIGINT/SIGTERM, refuse new connections with with_graceful_shutdown, stop background tasks via CancellationToken, set timeouts, and integrate with Docker/Kubernetes termination ‚Äî protect data integrity and user experience.","keywords":["Rust","Axum","Tokio","Graceful Shutdown","SIGTERM","SIGINT","CancellationToken","Kubernetes","Docker","production","microservice","backend"],"articleBody":"Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit\nFollow Moshou Coding on WeChat to learn Rust the easy way.\nDo these production nightmares look familiar? You reboot the server and lose user data. DB connections fail and transactions get rolled back. WebSocket links drop and the UX craters. The root cause is a detail 99% of developers overlook ‚Äî Rust Axum graceful shutdown.\nLet‚Äôs make it practical and friendly while staying production‚Äëgrade.\nWhy graceful shutdown matters in Rust Axum A robust graceful shutdown mechanism helps you:\nComplete in‚Äëflight HTTP requests to prevent data loss Ensure DB transactions commit/rollback correctly Notify real‚Äëtime clients (WebSocket, SSE) before closing Meet availability and compliance requirements Step 1: Build the signal listener Listen for SIGINT (Ctrl+C) and SIGTERM (system/Docker) with Tokio:\nuse tokio::signal; async fn shutdown_signal() { let ctrl_c = async { signal::ctrl_c() .await .expect(\"failed to install Ctrl+C handler\"); }; #[cfg(unix)] let terminate = async { signal::unix::signal(signal::unix::SignalKind::terminate()) .expect(\"failed to install signal handler\") .recv() .await; }; #[cfg(not(unix))] let terminate = std::future::pending::\u003c()\u003e(); tokio::select! { _ = ctrl_c =\u003e {}, _ = terminate =\u003e {}, } println!(\"Shutdown signal received. Preparing graceful exit...\"); } Step 2: Teach Axum to shut down gracefully Use with_graceful_shutdown(shutdown_signal()) so the server stops accepting new connections while finishing in‚Äëflight ones.\nStep 3: Stop background tasks cleanly Use CancellationToken to propagate a stop signal to long‚Äërunning tasks:\nuse tokio_util::sync::CancellationToken; async fn background_task(token: CancellationToken) { while !token.is_cancelled() { println!(\"background worker running...\"); tokio::select! { _ = tokio::time::sleep(std::time::Duration::from_secs(1)) =\u003e {} _ = token.cancelled() =\u003e { break; } } } println!(\"background worker finished cleanup\"); } Final assembly use axum::{routing::get, Router}; use tokio::net::TcpListener; use tokio_util::sync::CancellationToken; async fn hello() -\u003e \u0026'static str { \"Hello, World!\" } #[tokio::main] async fn main() { let app = Router::new().route(\"/\", get(hello)); let cancellation_token = CancellationToken::new(); let token_clone = cancellation_token.clone(); let background_handle = tokio::spawn(background_task(token_clone)); let listener = TcpListener::bind((\"127.0.0.1\", 3000)).await.unwrap(); println!(\"listening on {:?}\", listener.local_addr().unwrap()); axum::serve(listener, app) .with_graceful_shutdown(shutdown_signal()) .await .unwrap(); cancellation_token.cancel(); if let Err(e) = background_handle.await { eprintln!(\"background task join error: {}\", e); } println!(\"shutdown complete\"); } Production best practices Timeout: 30‚Äì60s window to finish in‚Äëflight work use tokio::time::{timeout, Duration}; let shutdown_timeout = Duration::from_secs(30); if let Err(_) = timeout(shutdown_timeout, graceful_shutdown).await { eprintln!(\"graceful shutdown timed out; exiting\"); } Observability: log start/finish, in‚Äëflight counts, error rates Health checks: degrade readiness during draining to stop new traffic DB pools: close gracefully and await inflight queries FAQ Docker SIGTERM: Docker sends SIGTERM first; handle it and avoid relying on SIGKILL Kubernetes: set terminationGracePeriodSeconds (typically 60‚Äì120s) and use PreStop hooks if needed Long background work: persist progress and resume after restart Wrap‚Äëup With signal handling, connection draining, background task cancellation, and resource cleanup, your Axum service will shut down gracefully and safely across bare‚Äëmetal, Docker, and Kubernetes.\n","wordCount":"449","inLanguage":"en","image":"https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/conver.png","datePublished":"2025-08-17T00:00:00Z","dateModified":"2025-08-17T00:00:00Z","author":{"@type":"Person","name":"Rexai Programming"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rexai.top/en/tutorials/rust/rust-axum-graceful-shutdown-guide/"},"publisher":{"@type":"Organization","name":"Ê¢¶ÂÖΩÁºñÁ®ã","logo":{"@type":"ImageObject","url":"https://rexai.top/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://rexai.top/en/ accesskey=h title="Ê¢¶ÂÖΩÁºñÁ®ã (Alt + H)">Ê¢¶ÂÖΩÁºñÁ®ã</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://rexai.top/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>Zh-Cn</a></li></ul></div></div><button class=menu-toggle id=menu-toggle aria-label=ÊâìÂºÄËèúÂçï aria-controls=menu aria-expanded=false>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><ul id=menu role=menubar><li role=none><a href=https://rexai.top/en/ title=Home role=menuitem><span>Home</span></a></li><li class=has-submenu role=none><a href=https://rexai.top/en/tutorials/ title="üìö Tutorials" role=menuitem><span>üìö Tutorials</span>
<span class=submenu-toggle role=button tabindex=0 aria-expanded=false aria-haspopup=true>‚ñº</span></a><ul class=submenu role=menu><li role=none><a href=https://rexai.top/en/tutorials/rust/ title=Rust role=menuitem>Rust</a></li><li role=none><a href=https://rexai.top/en/tutorials/ai/ title="AI Programming" role=menuitem>AI Programming</a></li></ul></li><li role=none><a href=https://rexai.top/en/tools/ title=Tools role=menuitem><span>Tools</span></a></li><li role=none><a href=https://rexai.top/en/news/ title="üî• News" role=menuitem><span>üî• News</span></a></li><li role=none><a href=https://rexai.top/en/tags/ title="üè∑Ô∏è Tags" role=menuitem><span>üè∑Ô∏è Tags</span></a></li><li role=none><a href=https://rexai.top/en/categories/ title="üìÇ Categories" role=menuitem><span>üìÇ Categories</span></a></li></ul><div id=menu-overlay class=menu-overlay hidden></div></nav></header><style>.has-submenu{position:relative}#menu{overflow:visible !important}#menu li{overflow:visible}.submenu{position:absolute;top:100%;left:0;background:var(--theme);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);min-width:180px;z-index:1000;list-style:none;display:none;padding:.5rem 0}.submenu li{display:block;margin:0;line-height:1.5}#menu .submenu li+li{margin-inline-start:0}.submenu a{display:block;padding:.75rem 1rem;color:var(--secondary);text-decoration:none;transition:all .2s ease;border-radius:0}.submenu a:hover{background:var(--entry);color:var(--primary)}.has-submenu:hover .submenu{display:block !important}.submenu-toggle{margin-left:.25rem;font-size:.75rem;transition:transform .2s ease;display:inline-block}.has-submenu:hover .submenu-toggle{transform:rotate(180deg)}@media(max-width:768px){.menu-toggle{display:inline-flex;align-items:center;justify-content:center;width:44px;height:44px;margin-inline-end:var(--gap);border-radius:8px;border:1px solid var(--border);background:var(--theme);color:var(--primary)}#menu{position:fixed;top:0;right:0;height:100vh;width:82vw;max-width:340px;background:var(--theme);box-shadow:-2px 0 20px rgba(0,0,0,.18);transform:translateX(100%);transition:transform .25s ease;padding:calc(var(--header-height) + 10px)16px 20px;flex-direction:column;gap:4px;overflow-y:auto !important;z-index:1001}body.menu-open #menu{transform:translateX(0)}.menu-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:1000}body.menu-open .menu-overlay{opacity:1;pointer-events:auto}#menu li+li{margin-inline-start:0}#menu a{padding:12px 8px}.submenu{position:static;box-shadow:none;border:none;background:var(--entry);margin-top:0;margin-left:1rem;display:block;max-height:0;overflow:hidden;padding:0;transition:max-height .25s ease,padding .2s ease}.has-submenu.active .submenu{max-height:1000px;padding:4px 0 6px}.submenu-toggle{cursor:pointer}.has-submenu.active>a .submenu-toggle{transform:rotate(180deg)}}@media(min-width:769px){.menu-toggle{display:none}}.submenu a:focus-visible,#menu a:focus-visible,.menu-toggle:focus-visible,.submenu-toggle:focus-visible{outline:2px solid var(--primary);outline-offset:2px;border-radius:6px}@media(max-width:768px){#menu a.is-current,#menu a.is-current>span{border-bottom:none !important;background:var(--entry);color:var(--primary);border-radius:8px;font-weight:600}#menu a.is-current{padding:10px}#menu a{width:100%;border-radius:8px}#menu .active{border-bottom:none !important}}body.menu-open{overflow:hidden;touch-action:none}</style><script>(function(){const s=document.getElementById("menu"),t=document.getElementById("menu-toggle"),o=document.getElementById("menu-overlay");if(!s||!t||!o)return;const i=()=>window.innerWidth<=768,r=()=>{document.body.classList.add("menu-open"),t.setAttribute("aria-expanded","true"),o.hidden=!1,l()},n=()=>{document.body.classList.remove("menu-open"),t.setAttribute("aria-expanded","false"),o.hidden=!0,d(),t.focus()};t.addEventListener("click",()=>{const e=document.body.classList.contains("menu-open");e?n():r()}),o.addEventListener("click",n),window.addEventListener("keydown",e=>{e.key==="Escape"&&n()}),window.addEventListener("resize",()=>{window.innerWidth>768&&n()});const c=()=>{const e=Array.from(document.querySelectorAll(".has-submenu")),t=t=>{e.forEach(e=>{if(e!==t&&e.classList.contains("active")){e.classList.remove("active");const t=e.querySelector(".submenu-toggle");t&&t.setAttribute("aria-expanded","false")}})};e.forEach(e=>{const o=e.querySelector("a"),n=e.querySelector(".submenu-toggle"),a=e.querySelector(".submenu");if(!n||!a||!o)return;const r=t=>{n.setAttribute("aria-expanded",t?"true":"false"),e.classList.toggle("active",t)},s=()=>{const n=!e.classList.contains("active");n&&t(e),r(n)};n.addEventListener("click",e=>{if(!i())return;e.preventDefault(),e.stopPropagation(),s()}),n.addEventListener("keydown",e=>{if(!i())return;(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),s())}),o.addEventListener("click",e=>{if(!i())return;e.preventDefault(),e.stopPropagation(),s()})})};let e=[];const a=t=>{if(t.key!=="Tab"||!document.body.classList.contains("menu-open"))return;e=Array.from(s.querySelectorAll('a, button, [tabindex="0"]'));const n=e[0],o=e[e.length-1];if(!n||!o)return;t.shiftKey&&document.activeElement===n?(t.preventDefault(),o.focus()):!t.shiftKey&&document.activeElement===o&&(t.preventDefault(),n.focus())},l=()=>{e=Array.from(s.querySelectorAll('a, button, [tabindex="0"]')),e.length&&e[0].focus(),document.addEventListener("keydown",a)},d=()=>{document.removeEventListener("keydown",a)};c(),s.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element)||!i())return;const s=t.closest("a");if(!s)return;const o=s.closest("li"),a=o&&o.classList.contains("has-submenu");a||n()})})()</script><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit</h1><div class=post-description>Master graceful shutdown for Rust Axum services: listen for SIGINT/SIGTERM, refuse new connections with with_graceful_shutdown, stop background tasks via CancellationToken, set timeouts, and integrate with Docker/Kubernetes termination ‚Äî protect data integrity and user experience.</div><div class=post-meta><span title='2025-08-17 00:00:00 +0000 UTC'>August 17, 2025</span>&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;449 words&nbsp;¬∑&nbsp;Rexai Programming&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/>Zh-Cn</a></li></ul></div></header><figure class=entry-cover><img loading=eager srcset='https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/conver_hu_361d293a76507d8d.png 360w,https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/conver_hu_18f130af6ee3aaa1.png 480w,https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/conver_hu_ea7eeb062c408dca.png 720w,https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/conver_hu_acac9b848435fd1e.png 1080w,https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/conver_hu_9f80c30626630ccd.png 1500w,https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/conver.png 1536w' src=https://rexai.top/tutorials/rust/rust-axum-graceful-shutdown-guide/conver.png sizes="(min-width: 768px) 720px, 100vw" width=1536 height=1024 alt="Complete implementation and best practices for Rust Axum graceful shutdown"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#why-graceful-shutdown-matters-in-rust-axum aria-label="Why graceful shutdown matters in Rust Axum">Why graceful shutdown matters in Rust Axum</a></li><li><a href=#step-1-build-the-signal-listener aria-label="Step 1: Build the signal listener">Step 1: Build the signal listener</a></li><li><a href=#step-2-teach-axum-to-shut-down-gracefully aria-label="Step 2: Teach Axum to shut down gracefully">Step 2: Teach Axum to shut down gracefully</a></li><li><a href=#step-3-stop-background-tasks-cleanly aria-label="Step 3: Stop background tasks cleanly">Step 3: Stop background tasks cleanly</a></li><li><a href=#final-assembly aria-label="Final assembly">Final assembly</a></li><li><a href=#production-best-practices aria-label="Production best practices">Production best practices</a></li><li><a href=#faq aria-label=FAQ>FAQ</a></li><li><a href=#wrapup aria-label=Wrap‚Äëup>Wrap‚Äëup</a></li></ul></div></details></div><div class=post-content><p>Rust Axum Graceful Shutdown, The Ultimate Guide: Fix the pitfall 99% of engineers hit</p><p>Follow Moshou Coding on WeChat to learn Rust the easy way.</p><p>Do these production nightmares look familiar? You reboot the server and lose user data. DB connections fail and transactions get rolled back. WebSocket links drop and the UX craters. The root cause is a detail 99% of developers overlook ‚Äî Rust Axum graceful shutdown.</p><p>Let‚Äôs make it practical and friendly while staying production‚Äëgrade.</p><h2 id=why-graceful-shutdown-matters-in-rust-axum>Why graceful shutdown matters in Rust Axum<a hidden class=anchor aria-hidden=true href=#why-graceful-shutdown-matters-in-rust-axum>#</a></h2><p>A robust graceful shutdown mechanism helps you:</p><ul><li>Complete in‚Äëflight HTTP requests to prevent data loss</li><li>Ensure DB transactions commit/rollback correctly</li><li>Notify real‚Äëtime clients (WebSocket, SSE) before closing</li><li>Meet availability and compliance requirements</li></ul><h2 id=step-1-build-the-signal-listener>Step 1: Build the signal listener<a hidden class=anchor aria-hidden=true href=#step-1-build-the-signal-listener>#</a></h2><p>Listen for SIGINT (Ctrl+C) and SIGTERM (system/Docker) with Tokio:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::signal;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>shutdown_signal</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> ctrl_c <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>        signal::ctrl_c()
</span></span><span style=display:flex><span>            .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span>            .expect(<span style=color:#e6db74>&#34;failed to install Ctrl+C handler&#34;</span>);
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[cfg(unix)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> terminate <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> {
</span></span><span style=display:flex><span>        signal::unix::signal(signal::unix::SignalKind::terminate())
</span></span><span style=display:flex><span>            .expect(<span style=color:#e6db74>&#34;failed to install signal handler&#34;</span>)
</span></span><span style=display:flex><span>            .recv()
</span></span><span style=display:flex><span>            .<span style=color:#66d9ef>await</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#[cfg(not(unix))]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> terminate <span style=color:#f92672>=</span> std::future::pending::<span style=color:#f92672>&lt;</span>()<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    tokio::<span style=color:#a6e22e>select!</span> {
</span></span><span style=display:flex><span>        _ <span style=color:#f92672>=</span> ctrl_c <span style=color:#f92672>=&gt;</span> {},
</span></span><span style=display:flex><span>        _ <span style=color:#f92672>=</span> terminate <span style=color:#f92672>=&gt;</span> {},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Shutdown signal received. Preparing graceful exit...&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=step-2-teach-axum-to-shut-down-gracefully>Step 2: Teach Axum to shut down gracefully<a hidden class=anchor aria-hidden=true href=#step-2-teach-axum-to-shut-down-gracefully>#</a></h2><p>Use <code>with_graceful_shutdown(shutdown_signal())</code> so the server stops accepting new connections while finishing in‚Äëflight ones.</p><h2 id=step-3-stop-background-tasks-cleanly>Step 3: Stop background tasks cleanly<a hidden class=anchor aria-hidden=true href=#step-3-stop-background-tasks-cleanly>#</a></h2><p>Use <code>CancellationToken</code> to propagate a stop signal to long‚Äërunning tasks:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio_util::sync::CancellationToken;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>background_task</span>(token: <span style=color:#a6e22e>CancellationToken</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#f92672>!</span>token.is_cancelled() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;background worker running...&#34;</span>);
</span></span><span style=display:flex><span>        tokio::<span style=color:#a6e22e>select!</span> {
</span></span><span style=display:flex><span>            _ <span style=color:#f92672>=</span> tokio::time::sleep(std::time::Duration::from_secs(<span style=color:#ae81ff>1</span>)) <span style=color:#f92672>=&gt;</span> {}
</span></span><span style=display:flex><span>            _ <span style=color:#f92672>=</span> token.cancelled() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;background worker finished cleanup&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=final-assembly>Final assembly<a hidden class=anchor aria-hidden=true href=#final-assembly>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> axum::{routing::get, Router};
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::net::TcpListener;
</span></span><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio_util::sync::CancellationToken;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>hello</span>() -&gt; <span style=color:#66d9ef>&amp;</span>&#39;static <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Hello, World!&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#[tokio::main]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> app <span style=color:#f92672>=</span> Router::new().route(<span style=color:#e6db74>&#34;/&#34;</span>, get(hello));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> cancellation_token <span style=color:#f92672>=</span> CancellationToken::new();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> token_clone <span style=color:#f92672>=</span> cancellation_token.clone();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> background_handle <span style=color:#f92672>=</span> tokio::spawn(background_task(token_clone));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> listener <span style=color:#f92672>=</span> TcpListener::bind((<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#ae81ff>3000</span>)).<span style=color:#66d9ef>await</span>.unwrap();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;listening on </span><span style=color:#e6db74>{:?}</span><span style=color:#e6db74>&#34;</span>, listener.local_addr().unwrap());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    axum::serve(listener, app)
</span></span><span style=display:flex><span>        .with_graceful_shutdown(shutdown_signal())
</span></span><span style=display:flex><span>        .<span style=color:#66d9ef>await</span>
</span></span><span style=display:flex><span>        .unwrap();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    cancellation_token.cancel();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Err(e) <span style=color:#f92672>=</span> background_handle.<span style=color:#66d9ef>await</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>eprintln!</span>(<span style=color:#e6db74>&#34;background task join error: </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, e);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;shutdown complete&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=production-best-practices>Production best practices<a hidden class=anchor aria-hidden=true href=#production-best-practices>#</a></h2><ul><li>Timeout: 30‚Äì60s window to finish in‚Äëflight work</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>use</span> tokio::time::{timeout, Duration};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> shutdown_timeout <span style=color:#f92672>=</span> Duration::from_secs(<span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> Err(_) <span style=color:#f92672>=</span> timeout(shutdown_timeout, graceful_shutdown).<span style=color:#66d9ef>await</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>eprintln!</span>(<span style=color:#e6db74>&#34;graceful shutdown timed out; exiting&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Observability: log start/finish, in‚Äëflight counts, error rates</li><li>Health checks: degrade readiness during draining to stop new traffic</li><li>DB pools: close gracefully and await inflight queries</li></ul><h2 id=faq>FAQ<a hidden class=anchor aria-hidden=true href=#faq>#</a></h2><ul><li>Docker SIGTERM: Docker sends SIGTERM first; handle it and avoid relying on SIGKILL</li><li>Kubernetes: set <code>terminationGracePeriodSeconds</code> (typically 60‚Äì120s) and use PreStop hooks if needed</li><li>Long background work: persist progress and resume after restart</li></ul><h2 id=wrapup>Wrap‚Äëup<a hidden class=anchor aria-hidden=true href=#wrapup>#</a></h2><p>With signal handling, connection draining, background task cancellation, and resource cleanup, your Axum service will shut down gracefully and safely across bare‚Äëmetal, Docker, and Kubernetes.</p></div><section class=post-actions aria-label="post actions"><div class=post-actions__group><div class=post-actions__item><script type=text/javascript src=https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js data-name=bmc-button data-slug=winbbryz data-color=#FFDD00 data-emoji data-font=Cookie data-text="Buy me a coffee" data-outline-color=#000000 data-font-color=#000000 data-coffee-color=#ffffff></script></div></div></section><footer class=post-footer><ul class=post-tags><li><a href=https://rexai.top/en/tags/rust/>Rust</a></li><li><a href=https://rexai.top/en/tags/axum/>Axum</a></li><li><a href=https://rexai.top/en/tags/tokio/>Tokio</a></li><li><a href=https://rexai.top/en/tags/backend/>Backend</a></li><li><a href=https://rexai.top/en/tags/devops/>DevOps</a></li><li><a href=https://rexai.top/en/tags/graceful-shutdown/>Graceful Shutdown</a></li></ul></footer></article></main><footer class=footer><span>¬© <a href=https://rexai.top/>Ê¢¶ÂÖΩÁºñÁ®ã</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>