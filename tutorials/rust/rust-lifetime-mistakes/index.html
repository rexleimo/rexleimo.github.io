<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rust Lifetimes Explained: From 'a Errors to Mastery, Finally Understand the Borrow Checker | Ê¢¶ÂÖΩÁºñÁ®ã</title><meta name=keywords content="Rust,Rust lifetimes,Rust borrow checker,Rust tutorial,Rust beginner,'a,Lifetime Elision,Dangling Pointer,Rust borrowing,Rust ownership"><meta name=description content="Still struggling with Rust lifetimes? This article uses a humorous and easy-to-understand approach to help you finally grasp the true meaning of 'a, avoid the 5 most common pitfalls for beginners, and master Rust's borrowing and ownership to get ahead of your peers."><meta name=author content="Mengshou Programming"><link rel=canonical href=https://rexai.top/tutorials/rust/rust-lifetime-mistakes/><link crossorigin=anonymous href=/assets/css/stylesheet.852d08305fd9657bd0c1817a6ba86d4d8a66d40bbd25a67d45a8f93eb25903a1.css integrity="sha256-hS0IMF/ZZXvQwYF6a6htTYpm1Au9JaZ9Raj5PrJZA6E=" rel="preload stylesheet" as=style><link rel=icon href=https://rexai.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rexai.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rexai.top/favicon-32x32.png><link rel=apple-touch-icon href=https://rexai.top/apple-touch-icon.png><link rel=mask-icon href=https://rexai.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://rexai.top/zh-cn/tutorials/rust/rust-lifetime-mistakes/><link rel=alternate hreflang=en href=https://rexai.top/tutorials/rust/rust-lifetime-mistakes/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>.promotion-section{margin-top:2rem;text-align:center}.promotion-section h3{margin-bottom:1.5rem;color:var(--primary);font-size:1.25rem}.qr-codes{display:flex;gap:2rem;justify-content:center;flex-wrap:wrap}.qr-item{text-align:center}.qr-item img{width:150px;height:150px;border:1px solid #ddd;border-radius:8px;padding:8px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:transform .2s}.qr-item img:hover{transform:scale(1.05)}.qr-item p{margin-top:.5rem;font-size:.9rem;color:var(--secondary);font-weight:500}@media(max-width:768px){.qr-codes{flex-direction:column;align-items:center;gap:1rem}.qr-item img{width:120px;height:120px}}</style><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=winbbryz data-description="Support me on Buy me a coffee!" data-message data-color=#FF813F data-position=Right data-x_margin=18 data-y_margin=18></script><meta property="og:url" content="https://rexai.top/tutorials/rust/rust-lifetime-mistakes/"><meta property="og:site_name" content="Ê¢¶ÂÖΩÁºñÁ®ã"><meta property="og:title" content="Rust Lifetimes Explained: From 'a Errors to Mastery, Finally Understand the Borrow Checker"><meta property="og:description" content="Still struggling with Rust lifetimes? This article uses a humorous and easy-to-understand approach to help you finally grasp the true meaning of 'a, avoid the 5 most common pitfalls for beginners, and master Rust's borrowing and ownership to get ahead of your peers."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2025-07-24T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-24T00:00:00+00:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Lifetime"><meta property="article:tag" content="Ownership"><meta property="article:tag" content="Borrow Checker"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust Lifetimes Explained: From 'a Errors to Mastery, Finally Understand the Borrow Checker"><meta name=twitter:description content="Still struggling with Rust lifetimes? This article uses a humorous and easy-to-understand approach to help you finally grasp the true meaning of 'a, avoid the 5 most common pitfalls for beginners, and master Rust's borrowing and ownership to get ahead of your peers."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorials","item":"https://rexai.top/tutorials/"},{"@type":"ListItem","position":2,"name":"Rust Tutorials","item":"https://rexai.top/tutorials/rust/"},{"@type":"ListItem","position":3,"name":"Rust Lifetimes Explained: From 'a Errors to Mastery, Finally Understand the Borrow Checker","item":"https://rexai.top/tutorials/rust/rust-lifetime-mistakes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rust Lifetimes Explained: From 'a Errors to Mastery, Finally Understand the Borrow Checker","name":"Rust Lifetimes Explained: From \u0027a Errors to Mastery, Finally Understand the Borrow Checker","description":"Still struggling with Rust lifetimes? This article uses a humorous and easy-to-understand approach to help you finally grasp the true meaning of 'a, avoid the 5 most common pitfalls for beginners, and master Rust's borrowing and ownership to get ahead of your peers.","keywords":["Rust","Rust lifetimes","Rust borrow checker","Rust tutorial","Rust beginner","'a","Lifetime Elision","Dangling Pointer","Rust borrowing","Rust ownership"],"articleBody":"Still Stuck on Rust Lifetimes? Understand ‚Äòa and Secretly Outperform Your Colleagues Follow the Mengshou Programming WeChat official account for a fun way to learn Rust.\nWelcome to the world of Rust, brave developer! Here, you will meet a strict but loving guardian: the Borrow Checker. It gives Rust its unparalleled memory safety, but it also introduces a mysterious symbol that strikes fear into the hearts of countless beginners: 'a.\nThis little apostrophe looks like an ancient rune, full of mystery. What is it? Is it time? Is it magic?\nDon‚Äôt panic, let me unveil its mystery for you. A lifetime is not about time, but about ‚Äúscope.‚Äù It‚Äôs like a ‚Äúcontract‚Äù you use to promise the guardian (the borrow checker) that what you‚Äôve borrowed will absolutely be alive and valid while you‚Äôre using it.\nToday, let‚Äôs go over the most common ‚Äúlifetime pitfalls‚Äù for beginners and show you how to climb out of them gracefully, like a pro.\n1. Struct Lifetimes: Fixing the missing lifetime specifier Error Many beginners naively think that putting a reference in a struct is as simple as a regular variable.\nYou thought this would work:\nstruct User { name: \u0026str, // Fatal error! } The Guardian‚Äôs Whisper (Compiler Error): error[E0106]: missing lifetime specifier (‚ÄúHey, you borrowed something but didn‚Äôt tell me for how long. I can‚Äôt allow that!‚Äù)\nüí° Divine Intervention: Sign the Lifetime Contract\nstruct User\u003c'a\u003e { name: \u0026'a str, } See, we added \u003c'a\u003e. This is like a contract where you solemnly promise Rust: ‚ÄúHey, this User struct, and the name reference inside it, will not outlive a lifetime called 'a.‚Äù This reassures the guardian, who now knows the name you borrowed won‚Äôt ‚Äúdisappear‚Äù prematurely.\n2. Function Return References: Resolving Lifetime Mismatches This is perhaps the most common mistake. You write a function that tries to return one of two references, like returning the longer string.\nYou naively wrote:\nfn longest(a: \u0026str, b: \u0026str) -\u003e \u0026str { if a.len() \u003e b.len() { a } else { b } } The Guardian‚Äôs Whisper: \"Function returns a reference that may not live long enough.\" (‚ÄúYou want to return a reference, but I don‚Äôt know its ‚Äòorigin.‚Äô What if it comes from a short-lived source? How can I guarantee safety?‚Äù)\nüí° Divine Intervention: Clarify the Source of the Borrowed Item\nfn longest\u003c'a\u003e(a: \u0026'a str, b: \u0026'a str) -\u003e \u0026'a str { if a.len() \u003e b.len() { a } else { b } } Here, 'a once again plays a crucial role. It acts as a label, telling the compiler that the input parameters a and b, and the returned reference, all share the same lifetime 'a. This means the returned reference will live at least as long as the shorter of a and b. The guardian hears this, the logic is clear, and it immediately gives the green light.\n3. Ownership vs. Lifetimes: Why String Doesn‚Äôt Need 'a Lifetimes are created for ‚Äúborrowing.‚Äù If you are dealing with an owned type, like String, you don‚Äôt need this complex contract system.\nRedundant Code:\nstruct Book\u003c'a\u003e { title: String, // ‚úÖ You own it, no lifetime needed author: \u0026'a str, // ‚úÖ This is borrowed, a lifetime is required } Remember this iron rule: Only borrowed data (references) needs lifetime constraints. You can let your own data live as long as you want (until it goes out of scope) without promising anything to anyone.\n4. Dangling Pointers: Avoiding Returning Invalid References This is an extremely dangerous act, but fortunately, Rust‚Äôs guardian will firmly stop you. You try to create a value inside a function and then return a reference to it.\nA disastrous idea:\nfn get_str() -\u003e \u0026String { let s = String::from(\"Boom\"); // s is a \"temporary resident\" here \u0026s // You're trying to return a reference to a \"temporary resident\" } When the get_str function finishes, its internal variable s is destroyed, and its memory is reclaimed. The \u0026s you return becomes a ‚Äúdangling pointer‚Äù to nothing. In other languages, this could cause a crash, but in Rust, the guardian nips this danger in the bud at compile time.\nüí° Divine Intervention: Don‚Äôt Give the Key, Give the House!\nfn get_str() -\u003e String { let s = String::from(\"Boom\"); s // ‚úÖ Directly \"move\" the ownership of s out } If you want the outside of a function to use data from within, don‚Äôt be stingy and just return a reference. Return the String itself, transferring ownership. This way, the data gets a new owner and can continue to live.\n5. Lifetime Elision: When You Can Omit 'a After being tormented by lifetimes, you might develop a ‚Äúcompensation mentality‚Äù and want to sprinkle 'a everywhere.\nFor example:\nfn greet\u003c'a\u003e(name: \u0026'a str) { // The \u003c'a\u003e here is completely redundant println!(\"Hi, {name}!\"); } In fact, the Rust compiler is very smart and has a set of ‚ÄúLifetime Elision Rules.‚Äù In many common scenarios, like the function above, it can automatically infer the correct lifetimes, so you don‚Äôt need to annotate them manually.\nThe Golden Rule: Start simple. Only add lifetimes when the compiler complains. Let the guardian guide you, don‚Äôt guess its intentions.\nAdvanced: Understanding the Correct Use of the 'static Lifetime You will occasionally encounter a special lifetime: 'static.\nfn give_me_static() -\u003e \u0026'static str { \"I will exist forever!\" // String literals have a 'static lifetime } 'static means ‚Äúimmortal‚Äù; the data this reference points to will be valid for the entire duration of the program. String literals are the most typical example, as they are compiled directly into the program‚Äôs binary.\nUse 'static with caution. It‚Äôs typically used in advanced scenarios like threads or global state, and misusing it can lead to unexpected problems.\nConclusion: Getting Along with the Rust Borrow Checker Looking back now, is 'a still so scary?\nIt‚Äôs not your enemy, but the language you use to communicate with Rust‚Äôs memory guardian. You no longer need to memorize rules but understand the philosophy behind them:\nA reference in a struct? Tell it how long the loan will last. A function returning a reference? Tell it which input the loan comes from. An owned type? Forget about lifetimes. Temporary data in a function? Don‚Äôt just give the key, give the whole house away. The compiler isn‚Äôt complaining? Then trust it and don‚Äôt overdo it. Mastering lifetimes is mastering the art of conversing with the Rust guardian. When you can anticipate its thoughts and write code that satisfies it, you have truly begun to master Rust.\nFollow the Mengshou Programming WeChat official account for a fun way to learn Rust.\n","wordCount":"1096","inLanguage":"en","datePublished":"2025-07-24T00:00:00Z","dateModified":"2025-07-24T00:00:00Z","author":{"@type":"Person","name":"Mengshou Programming"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rexai.top/tutorials/rust/rust-lifetime-mistakes/"},"publisher":{"@type":"Organization","name":"Ê¢¶ÂÖΩÁºñÁ®ã","logo":{"@type":"ImageObject","url":"https://rexai.top/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://rexai.top/ accesskey=h title="Ê¢¶ÂÖΩÁºñÁ®ã (Alt + H)">Ê¢¶ÂÖΩÁºñÁ®ã</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://rexai.top/zh-cn/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>Zh-Cn</a></li></ul></div></div><ul id=menu><li><a href=https://rexai.top/ title=Home><span>Home</span></a></li><li class=has-submenu><a href=https://rexai.top/tutorials/ title="üìö Tutorials"><span>üìö Tutorials</span>
<span class=submenu-toggle>‚ñº</span></a><ul class=submenu><li><a href=https://rexai.top/tutorials/rust/ title=Rust>Rust</a></li><li><a href=https://rexai.top/tutorials/ai/ title="AI Programming">AI Programming</a></li></ul></li><li><a href=https://rexai.top/tools/ title=Tools><span>Tools</span></a></li><li><a href=https://rexai.top/tags/ title="üè∑Ô∏è Tags"><span>üè∑Ô∏è Tags</span></a></li><li><a href=https://rexai.top/categories/ title="üìÇ Categories"><span>üìÇ Categories</span></a></li></ul></nav></header><style>.has-submenu{position:relative}#menu{overflow:visible !important}#menu li{overflow:visible}.submenu{position:absolute;top:100%;left:0;background:var(--theme);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);min-width:180px;z-index:1000;list-style:none;display:none;padding:.5rem 0}.submenu li{display:block;margin:0;line-height:1.5}#menu .submenu li+li{margin-inline-start:0}.submenu a{display:block;padding:.75rem 1rem;color:var(--secondary);text-decoration:none;transition:all .2s ease;border-radius:0}.submenu a:hover{background:var(--entry);color:var(--primary)}.has-submenu:hover .submenu{display:block !important}.submenu-toggle{margin-left:.25rem;font-size:.75rem;transition:transform .2s ease;display:inline-block}.has-submenu:hover .submenu-toggle{transform:rotate(180deg)}@media(max-width:768px){.submenu{position:static;box-shadow:none;border:none;background:var(--entry);margin-top:0;margin-left:1rem;display:none;padding:0}.has-submenu.active .submenu{display:block}.submenu-toggle{cursor:pointer}}</style><script>window.innerWidth<=768&&document.querySelectorAll(".has-submenu").forEach(e=>{const n=e.querySelector("a"),t=e.querySelector(".submenu-toggle");t&&(t.addEventListener("click",function(t){t.preventDefault(),e.classList.toggle("active")}),n.addEventListener("click",function(t){e.classList.contains("has-submenu")&&(t.preventDefault(),e.classList.toggle("active"))}))})</script><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Rust Lifetimes Explained: From 'a Errors to Mastery, Finally Understand the Borrow Checker</h1><div class=post-description>Still struggling with Rust lifetimes? This article uses a humorous and easy-to-understand approach to help you finally grasp the true meaning of 'a, avoid the 5 most common pitfalls for beginners, and master Rust's borrowing and ownership to get ahead of your peers.</div><div class=post-meta><span title='2025-07-24 00:00:00 +0000 UTC'>July 24, 2025</span>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;1096 words&nbsp;¬∑&nbsp;Mengshou Programming&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://rexai.top/zh-cn/tutorials/rust/rust-lifetime-mistakes/>Zh-Cn</a></li></ul></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#still-stuck-on-rust-lifetimes-understand-a-and-secretly-outperform-your-colleagues aria-label="Still Stuck on Rust Lifetimes? Understand &lsquo;a and Secretly Outperform Your Colleagues">Still Stuck on Rust Lifetimes? Understand &lsquo;a and Secretly Outperform Your Colleagues</a><ul><li><a href=#1-struct-lifetimes-fixing-the aria-label="1. Struct Lifetimes: Fixing the missing lifetime specifier Error">1. Struct Lifetimes: Fixing the missing lifetime specifier Error</a></li><li><a href=#2-function-return-references-resolving-lifetime-mismatches aria-label="2. Function Return References: Resolving Lifetime Mismatches">2. Function Return References: Resolving Lifetime Mismatches</a></li><li><a href=#3-ownership-vs-lifetimes-why aria-label="3. Ownership vs. Lifetimes: Why String Doesn&rsquo;t Need 'a">3. Ownership vs. Lifetimes: Why String Doesn&rsquo;t Need 'a</a></li><li><a href=#4-dangling-pointers-avoiding-returning-invalid-references aria-label="4. Dangling Pointers: Avoiding Returning Invalid References">4. Dangling Pointers: Avoiding Returning Invalid References</a></li><li><a href=#5-lifetime-elision-when-you-can-omit aria-label="5. Lifetime Elision: When You Can Omit 'a">5. Lifetime Elision: When You Can Omit 'a</a></li><li><a href=#advanced-understanding-the-correct-use-of-the aria-label="Advanced: Understanding the Correct Use of the 'static Lifetime">Advanced: Understanding the Correct Use of the 'static Lifetime</a></li><li><a href=#conclusion-getting-along-with-the-rust-borrow-checker aria-label="Conclusion: Getting Along with the Rust Borrow Checker">Conclusion: Getting Along with the Rust Borrow Checker</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=still-stuck-on-rust-lifetimes-understand-a-and-secretly-outperform-your-colleagues>Still Stuck on Rust Lifetimes? Understand &lsquo;a and Secretly Outperform Your Colleagues<a hidden class=anchor aria-hidden=true href=#still-stuck-on-rust-lifetimes-understand-a-and-secretly-outperform-your-colleagues>#</a></h1><p><strong>Follow the Mengshou Programming WeChat official account for a fun way to learn Rust.</strong></p><p>Welcome to the world of Rust, brave developer! Here, you will meet a strict but loving guardian: the <strong>Borrow Checker</strong>. It gives Rust its unparalleled memory safety, but it also introduces a mysterious symbol that strikes fear into the hearts of countless beginners: <code>'a</code>.</p><p>This little apostrophe looks like an ancient rune, full of mystery. What is it? Is it time? Is it magic?</p><p>Don&rsquo;t panic, let me unveil its mystery for you. <strong>A lifetime is not about time, but about &ldquo;scope.&rdquo;</strong> It&rsquo;s like a &ldquo;contract&rdquo; you use to promise the guardian (the borrow checker) that what you&rsquo;ve borrowed will absolutely be alive and valid while you&rsquo;re using it.</p><p>Today, let&rsquo;s go over the most common &ldquo;lifetime pitfalls&rdquo; for beginners and show you how to climb out of them gracefully, like a pro.</p><h2 id=1-struct-lifetimes-fixing-the><strong>1. Struct Lifetimes: Fixing the <code>missing lifetime specifier</code> Error</strong><a hidden class=anchor aria-hidden=true href=#1-struct-lifetimes-fixing-the>#</a></h2><p>Many beginners naively think that putting a reference in a struct is as simple as a regular variable.</p><p><strong>You thought this would work:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>User</span> {
</span></span><span style=display:flex><span>    name: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>, <span style=color:#75715e>// Fatal error!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p><strong>The Guardian&rsquo;s Whisper (Compiler Error):</strong>
<code>error[E0106]: missing lifetime specifier</code>
(&ldquo;Hey, you borrowed something but didn&rsquo;t tell me for how long. I can&rsquo;t allow that!&rdquo;)</p><p><strong>üí° Divine Intervention: Sign the Lifetime Contract</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>User</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    name: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>See, we added <code>&lt;'a></code>. This is like a contract where you solemnly promise Rust: &ldquo;Hey, this <code>User</code> struct, and the <code>name</code> reference inside it, will not outlive a lifetime called <code>'a</code>.&rdquo; This reassures the guardian, who now knows the <code>name</code> you borrowed won&rsquo;t &ldquo;disappear&rdquo; prematurely.</p><h2 id=2-function-return-references-resolving-lifetime-mismatches><strong>2. Function Return References: Resolving Lifetime Mismatches</strong><a hidden class=anchor aria-hidden=true href=#2-function-return-references-resolving-lifetime-mismatches>#</a></h2><p>This is perhaps the most common mistake. You write a function that tries to return one of two references, like returning the longer string.</p><p><strong>You naively wrote:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>longest</span>(a: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>, b: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> a.len() <span style=color:#f92672>&gt;</span> b.len() { a } <span style=color:#66d9ef>else</span> { b }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>The Guardian&rsquo;s Whisper:</strong>
<code>"Function returns a reference that may not live long enough."</code>
(&ldquo;You want to return a reference, but I don&rsquo;t know its &lsquo;origin.&rsquo; What if it comes from a short-lived source? How can I guarantee safety?&rdquo;)</p><p><strong>üí° Divine Intervention: Clarify the Source of the Borrowed Item</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>longest</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span>(a: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>, b: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> a.len() <span style=color:#f92672>&gt;</span> b.len() { a } <span style=color:#66d9ef>else</span> { b }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here, <code>'a</code> once again plays a crucial role. It acts as a label, telling the compiler that the input parameters <code>a</code> and <code>b</code>, and the returned reference, all share the same lifetime <code>'a</code>. This means the returned reference will live at least as long as the shorter of <code>a</code> and <code>b</code>. The guardian hears this, the logic is clear, and it immediately gives the green light.</p><h2 id=3-ownership-vs-lifetimes-why><strong>3. Ownership vs. Lifetimes: Why <code>String</code> Doesn&rsquo;t Need <code>'a</code></strong><a hidden class=anchor aria-hidden=true href=#3-ownership-vs-lifetimes-why>#</a></h2><p>Lifetimes are created for &ldquo;borrowing.&rdquo; If you are dealing with an owned type, like <code>String</code>, you don&rsquo;t need this complex contract system.</p><p><strong>Redundant Code:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Book</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    title: String,      <span style=color:#75715e>// ‚úÖ You own it, no lifetime needed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    author: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>,    <span style=color:#75715e>// ‚úÖ This is borrowed, a lifetime is required
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Remember this iron rule: <strong>Only borrowed data (references) needs lifetime constraints.</strong> You can let your own data live as long as you want (until it goes out of scope) without promising anything to anyone.</p><h2 id=4-dangling-pointers-avoiding-returning-invalid-references><strong>4. Dangling Pointers: Avoiding Returning Invalid References</strong><a hidden class=anchor aria-hidden=true href=#4-dangling-pointers-avoiding-returning-invalid-references>#</a></h2><p>This is an extremely dangerous act, but fortunately, Rust&rsquo;s guardian will firmly stop you. You try to create a value inside a function and then return a reference to it.</p><p><strong>A disastrous idea:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>get_str</span>() -&gt; <span style=color:#66d9ef>&amp;</span>String {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> s <span style=color:#f92672>=</span> String::from(<span style=color:#e6db74>&#34;Boom&#34;</span>); <span style=color:#75715e>// s is a &#34;temporary resident&#34; here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&amp;</span>s <span style=color:#75715e>// You&#39;re trying to return a reference to a &#34;temporary resident&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>When the <code>get_str</code> function finishes, its internal variable <code>s</code> is destroyed, and its memory is reclaimed. The <code>&amp;s</code> you return becomes a &ldquo;dangling pointer&rdquo; to nothing. In other languages, this could cause a crash, but in Rust, the guardian nips this danger in the bud at compile time.</p><p><strong>üí° Divine Intervention: Don&rsquo;t Give the Key, Give the House!</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>get_str</span>() -&gt; String {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> s <span style=color:#f92672>=</span> String::from(<span style=color:#e6db74>&#34;Boom&#34;</span>);
</span></span><span style=display:flex><span>    s <span style=color:#75715e>// ‚úÖ Directly &#34;move&#34; the ownership of s out
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>If you want the outside of a function to use data from within, don&rsquo;t be stingy and just return a reference. Return the <code>String</code> itself, transferring ownership. This way, the data gets a new owner and can continue to live.</p><h2 id=5-lifetime-elision-when-you-can-omit><strong>5. Lifetime Elision: When You Can Omit <code>'a</code></strong><a hidden class=anchor aria-hidden=true href=#5-lifetime-elision-when-you-can-omit>#</a></h2><p>After being tormented by lifetimes, you might develop a &ldquo;compensation mentality&rdquo; and want to sprinkle <code>'a</code> everywhere.</p><p><strong>For example:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>greet</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span>(name: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>) { <span style=color:#75715e>// The &lt;&#39;a&gt; here is completely redundant
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Hi, </span><span style=color:#e6db74>{name}</span><span style=color:#e6db74>!&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In fact, the Rust compiler is very smart and has a set of &ldquo;Lifetime Elision Rules.&rdquo; In many common scenarios, like the function above, it can automatically infer the correct lifetimes, so you don&rsquo;t need to annotate them manually.</p><p><strong>The Golden Rule:</strong> <strong>Start simple. Only add lifetimes when the compiler complains.</strong> Let the guardian guide you, don&rsquo;t guess its intentions.</p><h2 id=advanced-understanding-the-correct-use-of-the><strong>Advanced: Understanding the Correct Use of the <code>'static</code> Lifetime</strong><a hidden class=anchor aria-hidden=true href=#advanced-understanding-the-correct-use-of-the>#</a></h2><p>You will occasionally encounter a special lifetime: <code>'static</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>give_me_static</span>() -&gt; <span style=color:#66d9ef>&amp;</span>&#39;static <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;I will exist forever!&#34;</span> <span style=color:#75715e>// String literals have a &#39;static lifetime
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p><code>'static</code> means &ldquo;immortal&rdquo;; the data this reference points to will be valid for the entire duration of the program. String literals are the most typical example, as they are compiled directly into the program&rsquo;s binary.</p><p>Use <code>'static</code> with caution. It&rsquo;s typically used in advanced scenarios like threads or global state, and misusing it can lead to unexpected problems.</p><h2 id=conclusion-getting-along-with-the-rust-borrow-checker><strong>Conclusion: Getting Along with the Rust Borrow Checker</strong><a hidden class=anchor aria-hidden=true href=#conclusion-getting-along-with-the-rust-borrow-checker>#</a></h2><p>Looking back now, is <code>'a</code> still so scary?</p><p>It&rsquo;s not your enemy, but the language you use to communicate with Rust&rsquo;s memory guardian. You no longer need to memorize rules but understand the philosophy behind them:</p><ul><li><strong>A reference in a struct?</strong> Tell it how long the loan will last.</li><li><strong>A function returning a reference?</strong> Tell it which input the loan comes from.</li><li><strong>An owned type?</strong> Forget about lifetimes.</li><li><strong>Temporary data in a function?</strong> Don&rsquo;t just give the key, give the whole house away.</li><li><strong>The compiler isn&rsquo;t complaining?</strong> Then trust it and don&rsquo;t overdo it.</li></ul><p>Mastering lifetimes is mastering the art of conversing with the Rust guardian. When you can anticipate its thoughts and write code that satisfies it, you have truly begun to master Rust.</p><hr><p><strong>Follow the Mengshou Programming WeChat official account for a fun way to learn Rust.</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://rexai.top/tags/rust/>Rust</a></li><li><a href=https://rexai.top/tags/lifetime/>Lifetime</a></li><li><a href=https://rexai.top/tags/ownership/>Ownership</a></li><li><a href=https://rexai.top/tags/borrow-checker/>Borrow Checker</a></li></ul></footer></article></main><footer class=footer><span>¬© <a href=https://rexai.top/>Ê¢¶ÂÖΩÁºñÁ®ã</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>