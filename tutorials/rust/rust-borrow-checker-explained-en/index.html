<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rust Borrow Checker Explained: A Beginner's Guide to Ownership, Borrowing, and Lifetimes | Ê¢¶ÂÖΩÁºñÁ®ã</title><meta name=keywords content="Rust,Borrow Checker,Rust Tutorial,Ownership,Lifetimes,Rust for Beginners,Rust Programming,Memory Safety"><meta name=description content="A deep but simple dive into Rust's core concept: the Borrow Checker. Using a vivid analogy, this article explains ownership, borrowing, and lifetimes, helping you conquer compile errors and master Rust's safety."><meta name=author content="Dream-Beast Programming"><link rel=canonical href=https://rexai.top/tutorials/rust/rust-borrow-checker-explained-en/><link crossorigin=anonymous href=/assets/css/stylesheet.852d08305fd9657bd0c1817a6ba86d4d8a66d40bbd25a67d45a8f93eb25903a1.css integrity="sha256-hS0IMF/ZZXvQwYF6a6htTYpm1Au9JaZ9Raj5PrJZA6E=" rel="preload stylesheet" as=style><link rel=icon href=https://rexai.top/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://rexai.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://rexai.top/favicon-32x32.png><link rel=apple-touch-icon href=https://rexai.top/apple-touch-icon.png><link rel=mask-icon href=https://rexai.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh-cn href=https://rexai.top/zh-cn/tutorials/rust/rust-borrow-checker-explained-zh/><link rel=alternate hreflang=en href=https://rexai.top/tutorials/rust/rust-borrow-checker-explained-en/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><style>.promotion-section{margin-top:2rem;text-align:center}.promotion-section h3{margin-bottom:1.5rem;color:var(--primary);font-size:1.25rem}.qr-codes{display:flex;gap:2rem;justify-content:center;flex-wrap:wrap}.qr-item{text-align:center}.qr-item img{width:150px;height:150px;border:1px solid #ddd;border-radius:8px;padding:8px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:transform .2s}.qr-item img:hover{transform:scale(1.05)}.qr-item p{margin-top:.5rem;font-size:.9rem;color:var(--secondary);font-weight:500}@media(max-width:768px){.qr-codes{flex-direction:column;align-items:center;gap:1rem}.qr-item img{width:120px;height:120px}}</style><script>(function(e,t,n,s,o){e[s]=e[s]||[],e[s].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var a=t.getElementsByTagName(n)[0],i=t.createElement(n),r=s!="dataLayer"?"&l="+s:"";i.async=!0,i.src="https://www.googletagmanager.com/gtm.js?id="+o+r,a.parentNode.insertBefore(i,a)})(window,document,"script","dataLayer","GTM-K6VQRF8T")</script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=winbbryz data-description="Support me on Buy me a coffee!" data-message data-color=#FF813F data-position=Right data-x_margin=18 data-y_margin=18></script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K6VQRF8T" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><meta property="og:url" content="https://rexai.top/tutorials/rust/rust-borrow-checker-explained-en/"><meta property="og:site_name" content="Ê¢¶ÂÖΩÁºñÁ®ã"><meta property="og:title" content="Rust Borrow Checker Explained: A Beginner's Guide to Ownership, Borrowing, and Lifetimes"><meta property="og:description" content="A deep but simple dive into Rust's core concept: the Borrow Checker. Using a vivid analogy, this article explains ownership, borrowing, and lifetimes, helping you conquer compile errors and master Rust's safety."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2024-07-26T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-26T00:00:00+00:00"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Programming Languages"><meta property="article:tag" content="Systems Programming"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rust Borrow Checker Explained: A Beginner's Guide to Ownership, Borrowing, and Lifetimes"><meta name=twitter:description content="A deep but simple dive into Rust's core concept: the Borrow Checker. Using a vivid analogy, this article explains ownership, borrowing, and lifetimes, helping you conquer compile errors and master Rust's safety."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Tutorials","item":"https://rexai.top/tutorials/"},{"@type":"ListItem","position":2,"name":"Rust Tutorials","item":"https://rexai.top/tutorials/rust/"},{"@type":"ListItem","position":3,"name":"Rust Borrow Checker Explained: A Beginner's Guide to Ownership, Borrowing, and Lifetimes","item":"https://rexai.top/tutorials/rust/rust-borrow-checker-explained-en/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rust Borrow Checker Explained: A Beginner's Guide to Ownership, Borrowing, and Lifetimes","name":"Rust Borrow Checker Explained: A Beginner\u0027s Guide to Ownership, Borrowing, and Lifetimes","description":"A deep but simple dive into Rust's core concept: the Borrow Checker. Using a vivid analogy, this article explains ownership, borrowing, and lifetimes, helping you conquer compile errors and master Rust's safety.","keywords":["Rust","Borrow Checker","Rust Tutorial","Ownership","Lifetimes","Rust for Beginners","Rust Programming","Memory Safety"],"articleBody":"Follow Dream-Beast Programming for more fun Rust tutorials!\nIf you‚Äôre just stepping into the world of Rust, you‚Äôve likely heard of its ‚ÄúBig Three‚Äù that scare off beginners: Ownership, Lifetimes, and our star for today‚Äîthe infamous Borrow Checker.\nMany see it as an unreasonable tyrant, constantly pointing fingers at your code and throwing a wall of red error messages at you, making you want to smash your keyboard. But today, I‚Äôm here to reveal its true identity. It‚Äôs not a tyrant; it‚Äôs the most loyal and powerful bodyguard in your programming world.\nImagine your program‚Äôs memory is a top-tier private club, holding all sorts of valuable data as its VIPs. The borrow checker is that stone-faced, eagle-eyed bodyguard at the entrance who can spot any potential risk in a single glance.\nAct I: Borrowing? Just ‚ÄúLending a Book‚Äù In programming, we often need different parts of our code to access the same piece of data. In many languages, this is like casually handing out photocopies of your VIP client list. Before you know it, you can‚Äôt tell which is the original and which has been altered, leading to utter chaos.\nBut in Rust, we have rules. We don‚Äôt just ‚Äúgive away‚Äù data (transferring ownership); we prefer to ‚Äúborrow‚Äù it.\nIt‚Äôs like you have a prized, collector‚Äôs edition book. A friend wants to read it. You wouldn‚Äôt just give the book away; you‚Äôd lend it to them, telling them to return it when they‚Äôre done. The ownership of the book is still yours; your friend only has temporary reading rights.\nLet‚Äôs see how the bodyguard manages this process:\nfn greet(name: \u0026str) { // The 'name' parameter gets a \"read-only temporary pass\" println!(\"Hello, {}!\", name); } fn main() { let user = String::from(\"Dream-Beast\"); // \"Dream-Beast\" is our esteemed VIP greet(\u0026user); // We hand greet() a \"read-only pass\" to user println!(\"{} is still here, safe and sound!\", user); // The VIP is perfectly fine } See that? The \u0026 in \u0026user is a ‚Äútemporary pass.‚Äù The greet function just used the pass to say hello to the VIP, but the VIP (user variable) never left its seat. This is borrowing‚Äîelegant and safe.\nAct II: Why Is the Bodyguard Suddenly ‚ÄúYelling‚Äù at You? The peace and quiet never last long. Soon enough, you‚Äôll encounter a moment where the bodyguard ‚Äúyells‚Äù at you. Don‚Äôt be scared. It‚Äôs just because you might have accidentally broken one of the club‚Äôs ‚ÄúThree Safety Rules.‚Äù\nRule 1: You can look, but you can‚Äôt touch. You can hand out as many ‚Äúread-only passes‚Äù (\u0026T) as you want, letting countless code blocks observe your VIP data. It doesn‚Äôt matter how many there are, since none of them can lay a finger on the VIP.\nRule 2: For serious business, it must be a private meeting. Once you issue a ‚Äúmodifiable pass‚Äù (\u0026mut T) to let a piece of code have a ‚Äúdeep conversation‚Äù (modify the data) with the VIP, then sorry, the entire club must be cleared. All ‚Äúread-only‚Äù observers must leave temporarily.\nRule 3: Observing and private meetings can NEVER happen at the same time! This is the most crucial rule. The bodyguard will never allow a group of people to watch while someone is in a ‚Äúdeep conversation‚Äù with the VIP. It‚Äôs too dangerous! What if the observers see something different from what‚Äôs being modified? What if the person modifying is only halfway done when an observer rushes in?\nLook at this reckless attempt below and see how the bodyguard stops a disaster before it happens:\nfn main() { let mut name = String::from(\"Rusty\"); // A mutable VIP let r1 = \u0026name; // Issue a \"read-only pass\" to r1 let r2 = \u0026mut name; // Attempt to issue a \"modifiable pass\" to r2 // üö® The bodyguard yells immediately: Stop! What do you think you're doing? // error: cannot borrow `name` as mutable because it is also borrowed as immutable println!(\"{}\", r1); } The bodyguard (the Rust compiler) will stop you right there, sternly warning you with a red error message: ‚ÄúHey! You already gave a read-only pass to r1, and now you want r2 to go in and make changes? Are you trying to cause chaos? Not on my watch!‚Äù\nAct III: Lifetimes ‚Äî The ‚ÄúExpiration Date‚Äù on the Pass You might think, ‚ÄúI just have to follow the rules above, right?‚Äù Not so fast. A top-tier bodyguard cares not only about who gets in but also how long they can stay. This is the essence of ‚ÄúLifetimes.‚Äù\nA lifetime is simply the ‚Äúexpiration date‚Äù on the pass.\nWhat‚Äôs the worst kind of chaos? It‚Äôs when you excitedly rush to see the VIP, pass in hand, only to find the VIP has already left the club (the memory they occupied has been freed). You‚Äôre left holding a pass that points to thin air. This is the infamous ‚Äúdangling pointer,‚Äù the nightmare of countless C++ programmers.\nBut in Club Rust, this can never happen. When the bodyguard issues you a pass, it‚Äôs already stamped with an expiration date.\nMost of the time, the bodyguard is smart enough to figure out this expiration date automatically, so you don‚Äôt have to worry. But sometimes, when the logic gets complicated‚Äîlike when a function needs to return a borrow‚Äîthe bodyguard gets a bit indecisive. It needs you to be explicit: whose expiration date should this returned pass follow?\n// 'a is a \"friendly hint\" we give to the bodyguard fn longest\u003c'a\u003e(a: \u0026'a str, b: \u0026'a str) -\u003e \u0026'a str { if a.len() \u003e b.len() { a } else { b } } That mysterious 'a (we call it a lifetime parameter) is not black magic. It‚Äôs just you communicating with the bodyguard: ‚ÄúHey, pal! Look closely. The expiration date on the pass this function returns should match the shorter of the two expiration dates from the passes a and b. Don‚Äôt worry, it‚Äôs totally safe!‚Äù\nYou‚Äôre essentially signing a contract of time with the bodyguard, guaranteeing that the returned reference will never outlive the data it refers to.\nFinale: A Salute to Your Ultimate Bodyguard So, do you still think the borrow checker is a ‚Äútyrant‚Äù?\nNo, it‚Äôs a silent guardian.\nIt trades compile-time ‚Äúyelling‚Äù for runtime ‚Äúpeace of mind.‚Äù No more ‚Äústop-the-world‚Äù pauses from a garbage collector (GC), no more heart-pounding data races in multithreading, and certainly no more dangling pointers that can crash your entire program.\nIt strangles every potential safety hazard in the cradle, at the very moment the code is born. It makes every line of Rust you write feel powerful and deterministic.\nThis bodyguard never asks for any runtime performance fee, yet provides you with financial-grade security. All it asks is that you think your ‚Äúrules‚Äù through. And once you understand its good intentions, you‚Äôll find that this isn‚Äôt a restriction at all‚Äîit‚Äôs the most complete freedom on the road to high performance and high security.\nRecommended Reading The Official Rust Book: Understanding Ownership: The authoritative guide from the Rust team, foundational for understanding the concepts behind the borrow checker. Rust By Example: Borrows: Walks you through the rules of mutable and immutable borrows with concrete code examples. Niko Matsakis‚Äôs Deep Dive: For readers who want to dive deeper into the mechanics and future of the borrow checker, this article by a Rust core developer is an invaluable resource. Did this article deepen your understanding of Rust? Don‚Äôt forget to follow Dream-Beast Programming for more ‚Äúaha!‚Äù moments and tech insights!\n","wordCount":"1242","inLanguage":"en","datePublished":"2024-07-26T00:00:00Z","dateModified":"2024-07-26T00:00:00Z","author":{"@type":"Person","name":"Dream-Beast Programming"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rexai.top/tutorials/rust/rust-borrow-checker-explained-en/"},"publisher":{"@type":"Organization","name":"Ê¢¶ÂÖΩÁºñÁ®ã","logo":{"@type":"ImageObject","url":"https://rexai.top/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://rexai.top/ accesskey=h title="Ê¢¶ÂÖΩÁºñÁ®ã (Alt + H)">Ê¢¶ÂÖΩÁºñÁ®ã</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://rexai.top/zh-cn/ title=‰∏≠Êñá aria-label=‰∏≠Êñá>Zh-Cn</a></li></ul></div></div><ul id=menu><li><a href=https://rexai.top/ title=Home><span>Home</span></a></li><li class=has-submenu><a href=https://rexai.top/tutorials/ title="üìö Tutorials"><span>üìö Tutorials</span>
<span class=submenu-toggle>‚ñº</span></a><ul class=submenu><li><a href=https://rexai.top/tutorials/rust/ title=Rust>Rust</a></li><li><a href=https://rexai.top/tutorials/ai/ title="AI Programming">AI Programming</a></li></ul></li><li><a href=https://rexai.top/tools/ title=Tools><span>Tools</span></a></li><li><a href=https://rexai.top/news/ title="üî• News"><span>üî• News</span></a></li><li><a href=https://rexai.top/tags/ title="üè∑Ô∏è Tags"><span>üè∑Ô∏è Tags</span></a></li><li><a href=https://rexai.top/categories/ title="üìÇ Categories"><span>üìÇ Categories</span></a></li></ul></nav></header><style>.has-submenu{position:relative}#menu{overflow:visible !important}#menu li{overflow:visible}.submenu{position:absolute;top:100%;left:0;background:var(--theme);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 6px -1px rgba(0,0,0,.1);min-width:180px;z-index:1000;list-style:none;display:none;padding:.5rem 0}.submenu li{display:block;margin:0;line-height:1.5}#menu .submenu li+li{margin-inline-start:0}.submenu a{display:block;padding:.75rem 1rem;color:var(--secondary);text-decoration:none;transition:all .2s ease;border-radius:0}.submenu a:hover{background:var(--entry);color:var(--primary)}.has-submenu:hover .submenu{display:block !important}.submenu-toggle{margin-left:.25rem;font-size:.75rem;transition:transform .2s ease;display:inline-block}.has-submenu:hover .submenu-toggle{transform:rotate(180deg)}@media(max-width:768px){.submenu{position:static;box-shadow:none;border:none;background:var(--entry);margin-top:0;margin-left:1rem;display:none;padding:0}.has-submenu.active .submenu{display:block}.submenu-toggle{cursor:pointer}}</style><script>window.innerWidth<=768&&document.querySelectorAll(".has-submenu").forEach(e=>{const n=e.querySelector("a"),t=e.querySelector(".submenu-toggle");t&&(t.addEventListener("click",function(t){t.preventDefault(),e.classList.toggle("active")}),n.addEventListener("click",function(t){e.classList.contains("has-submenu")&&(t.preventDefault(),e.classList.toggle("active"))}))})</script><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Rust Borrow Checker Explained: A Beginner's Guide to Ownership, Borrowing, and Lifetimes</h1><div class=post-description>A deep but simple dive into Rust's core concept: the Borrow Checker. Using a vivid analogy, this article explains ownership, borrowing, and lifetimes, helping you conquer compile errors and master Rust's safety.</div><div class=post-meta><span title='2024-07-26 00:00:00 +0000 UTC'>July 26, 2024</span>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;1242 words&nbsp;¬∑&nbsp;Dream-Beast Programming&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://rexai.top/zh-cn/tutorials/rust/rust-borrow-checker-explained-zh/>Zh-Cn</a></li></ul></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#act-i-borrowing-just-lending-a-book aria-label="Act I: Borrowing? Just &ldquo;Lending a Book&rdquo;">Act I: Borrowing? Just &ldquo;Lending a Book&rdquo;</a></li><li><a href=#act-ii-why-is-the-bodyguard-suddenly-yelling-at-you aria-label="Act II: Why Is the Bodyguard Suddenly &ldquo;Yelling&rdquo; at You?">Act II: Why Is the Bodyguard Suddenly &ldquo;Yelling&rdquo; at You?</a></li><li><a href=#act-iii-lifetimes--the-expiration-date-on-the-pass aria-label="Act III: Lifetimes ‚Äî The &ldquo;Expiration Date&rdquo; on the Pass">Act III: Lifetimes ‚Äî The &ldquo;Expiration Date&rdquo; on the Pass</a></li><li><a href=#finale-a-salute-to-your-ultimate-bodyguard aria-label="Finale: A Salute to Your Ultimate Bodyguard">Finale: A Salute to Your Ultimate Bodyguard</a></li><li><a href=#recommended-reading aria-label="Recommended Reading">Recommended Reading</a></li></ul></div></details></div><div class=post-content><p><strong>Follow Dream-Beast Programming for more fun Rust tutorials!</strong></p><p>If you&rsquo;re just stepping into the world of Rust, you&rsquo;ve likely heard of its &ldquo;Big Three&rdquo; that scare off beginners: Ownership, Lifetimes, and our star for today‚Äîthe infamous <strong>Borrow Checker</strong>.</p><p>Many see it as an unreasonable tyrant, constantly pointing fingers at your code and throwing a wall of red error messages at you, making you want to smash your keyboard. But today, I‚Äôm here to reveal its true identity. It‚Äôs not a tyrant; it‚Äôs the most loyal and powerful bodyguard in your programming world.</p><p>Imagine your program&rsquo;s memory is a top-tier private club, holding all sorts of valuable data as its VIPs. The borrow checker is that stone-faced, eagle-eyed bodyguard at the entrance who can spot any potential risk in a single glance.</p><h2 id=act-i-borrowing-just-lending-a-book>Act I: Borrowing? Just &ldquo;Lending a Book&rdquo;<a hidden class=anchor aria-hidden=true href=#act-i-borrowing-just-lending-a-book>#</a></h2><p>In programming, we often need different parts of our code to access the same piece of data. In many languages, this is like casually handing out photocopies of your VIP client list. Before you know it, you can&rsquo;t tell which is the original and which has been altered, leading to utter chaos.</p><p>But in Rust, we have rules. We don&rsquo;t just &ldquo;give away&rdquo; data (transferring ownership); we prefer to &ldquo;borrow&rdquo; it.</p><p>It&rsquo;s like you have a prized, collector&rsquo;s edition book. A friend wants to read it. You wouldn&rsquo;t just give the book away; you&rsquo;d lend it to them, telling them to return it when they&rsquo;re done. The ownership of the book is still yours; your friend only has temporary reading rights.</p><p>Let&rsquo;s see how the bodyguard manages this process:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>greet</span>(name: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) { <span style=color:#75715e>// The &#39;name&#39; parameter gets a &#34;read-only temporary pass&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;Hello, </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>!&#34;</span>, name);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> user <span style=color:#f92672>=</span> String::from(<span style=color:#e6db74>&#34;Dream-Beast&#34;</span>); <span style=color:#75715e>// &#34;Dream-Beast&#34; is our esteemed VIP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    greet(<span style=color:#f92672>&amp;</span>user); <span style=color:#75715e>// We hand greet() a &#34;read-only pass&#34; to user
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74> is still here, safe and sound!&#34;</span>, user); <span style=color:#75715e>// The VIP is perfectly fine
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>See that? The <code>&</code> in <code>&amp;user</code> is a &ldquo;temporary pass.&rdquo; The <code>greet</code> function just used the pass to say hello to the VIP, but the VIP (<code>user</code> variable) never left its seat. This is borrowing‚Äîelegant and safe.</p><h2 id=act-ii-why-is-the-bodyguard-suddenly-yelling-at-you>Act II: Why Is the Bodyguard Suddenly &ldquo;Yelling&rdquo; at You?<a hidden class=anchor aria-hidden=true href=#act-ii-why-is-the-bodyguard-suddenly-yelling-at-you>#</a></h2><p>The peace and quiet never last long. Soon enough, you&rsquo;ll encounter a moment where the bodyguard &ldquo;yells&rdquo; at you. Don&rsquo;t be scared. It&rsquo;s just because you might have accidentally broken one of the club&rsquo;s &ldquo;Three Safety Rules.&rdquo;</p><p><strong>Rule 1: You can look, but you can&rsquo;t touch.</strong>
You can hand out as many &ldquo;read-only passes&rdquo; (<code>&amp;T</code>) as you want, letting countless code blocks observe your VIP data. It doesn&rsquo;t matter how many there are, since none of them can lay a finger on the VIP.</p><p><strong>Rule 2: For serious business, it must be a private meeting.</strong>
Once you issue a &ldquo;modifiable pass&rdquo; (<code>&amp;mut T</code>) to let a piece of code have a &ldquo;deep conversation&rdquo; (modify the data) with the VIP, then sorry, the entire club must be cleared. All &ldquo;read-only&rdquo; observers must leave temporarily.</p><p><strong>Rule 3: Observing and private meetings can NEVER happen at the same time!</strong>
This is the most crucial rule. The bodyguard will never allow a group of people to watch while someone is in a &ldquo;deep conversation&rdquo; with the VIP. It&rsquo;s too dangerous! What if the observers see something different from what&rsquo;s being modified? What if the person modifying is only halfway done when an observer rushes in?</p><p>Look at this reckless attempt below and see how the bodyguard stops a disaster before it happens:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> name <span style=color:#f92672>=</span> String::from(<span style=color:#e6db74>&#34;Rusty&#34;</span>); <span style=color:#75715e>// A mutable VIP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> r1 <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>name; <span style=color:#75715e>// Issue a &#34;read-only pass&#34; to r1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> r2 <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> name; <span style=color:#75715e>// Attempt to issue a &#34;modifiable pass&#34; to r2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// üö® The bodyguard yells immediately: Stop! What do you think you&#39;re doing?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// error: cannot borrow `name` as mutable because it is also borrowed as immutable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>println!</span>(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, r1); 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The bodyguard (the Rust compiler) will stop you right there, sternly warning you with a red error message: &ldquo;Hey! You already gave a read-only pass to <code>r1</code>, and now you want <code>r2</code> to go in and make changes? Are you trying to cause chaos? Not on my watch!&rdquo;</p><h2 id=act-iii-lifetimes--the-expiration-date-on-the-pass>Act III: Lifetimes ‚Äî The &ldquo;Expiration Date&rdquo; on the Pass<a hidden class=anchor aria-hidden=true href=#act-iii-lifetimes--the-expiration-date-on-the-pass>#</a></h2><p>You might think, &ldquo;I just have to follow the rules above, right?&rdquo; Not so fast. A top-tier bodyguard cares not only about <em>who</em> gets in but also <em>how long</em> they can stay. This is the essence of &ldquo;Lifetimes.&rdquo;</p><p>A lifetime is simply the &ldquo;expiration date&rdquo; on the pass.</p><p>What&rsquo;s the worst kind of chaos? It&rsquo;s when you excitedly rush to see the VIP, pass in hand, only to find the VIP has already left the club (the memory they occupied has been freed). You&rsquo;re left holding a pass that points to thin air. This is the infamous &ldquo;dangling pointer,&rdquo; the nightmare of countless C++ programmers.</p><p>But in Club Rust, this can never happen. When the bodyguard issues you a pass, it&rsquo;s already stamped with an expiration date.</p><p>Most of the time, the bodyguard is smart enough to figure out this expiration date automatically, so you don&rsquo;t have to worry. But sometimes, when the logic gets complicated‚Äîlike when a function needs to return a borrow‚Äîthe bodyguard gets a bit indecisive. It needs you to be explicit: whose expiration date should this returned pass follow?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>// &#39;a is a &#34;friendly hint&#34; we give to the bodyguard
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>longest</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>&#39;a</span><span style=color:#f92672>&gt;</span>(a: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>, b: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span>) -&gt; <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>&#39;a</span> <span style=color:#66d9ef>str</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> a.len() <span style=color:#f92672>&gt;</span> b.len() {
</span></span><span style=display:flex><span>        a
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        b
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>That mysterious <code>'a</code> (we call it a lifetime parameter) is not black magic. It&rsquo;s just you communicating with the bodyguard: &ldquo;Hey, pal! Look closely. The expiration date on the pass this function returns should match the shorter of the two expiration dates from the passes <code>a</code> and <code>b</code>. Don&rsquo;t worry, it&rsquo;s totally safe!&rdquo;</p><p>You&rsquo;re essentially signing a contract of time with the bodyguard, guaranteeing that the returned reference will never outlive the data it refers to.</p><h2 id=finale-a-salute-to-your-ultimate-bodyguard>Finale: A Salute to Your Ultimate Bodyguard<a hidden class=anchor aria-hidden=true href=#finale-a-salute-to-your-ultimate-bodyguard>#</a></h2><p>So, do you still think the borrow checker is a &ldquo;tyrant&rdquo;?</p><p>No, it&rsquo;s a silent guardian.</p><p>It trades compile-time &ldquo;yelling&rdquo; for runtime &ldquo;peace of mind.&rdquo; No more &ldquo;stop-the-world&rdquo; pauses from a garbage collector (GC), no more heart-pounding data races in multithreading, and certainly no more dangling pointers that can crash your entire program.</p><p>It strangles every potential safety hazard in the cradle, at the very moment the code is born. It makes every line of Rust you write feel powerful and deterministic.</p><p>This bodyguard never asks for any runtime performance fee, yet provides you with financial-grade security. All it asks is that you think your &ldquo;rules&rdquo; through. And once you understand its good intentions, you&rsquo;ll find that this isn&rsquo;t a restriction at all‚Äîit&rsquo;s the most complete freedom on the road to high performance and high security.</p><h2 id=recommended-reading>Recommended Reading<a hidden class=anchor aria-hidden=true href=#recommended-reading>#</a></h2><ul><li><strong><a href=https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html>The Official Rust Book: Understanding Ownership</a></strong>: The authoritative guide from the Rust team, foundational for understanding the concepts behind the borrow checker.</li><li><strong><a href=https://doc.rust-lang.org/rust-by-example/scope/borrow.html>Rust By Example: Borrows</a></strong>: Walks you through the rules of mutable and immutable borrows with concrete code examples.</li><li><strong><a href=https://nikomatsakis.github.io/2022/08/03/my-vision-for-a-borrow-checker-that-just-works.html>Niko Matsakis&rsquo;s Deep Dive</a></strong>: For readers who want to dive deeper into the mechanics and future of the borrow checker, this article by a Rust core developer is an invaluable resource.</li></ul><hr><p><strong>Did this article deepen your understanding of Rust? Don&rsquo;t forget to follow Dream-Beast Programming for more &ldquo;aha!&rdquo; moments and tech insights!</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://rexai.top/tags/rust/>Rust</a></li><li><a href=https://rexai.top/tags/programming-languages/>Programming Languages</a></li><li><a href=https://rexai.top/tags/systems-programming/>Systems Programming</a></li></ul></footer></article></main><footer class=footer><span>¬© <a href=https://rexai.top/>Ê¢¶ÂÖΩÁºñÁ®ã</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>